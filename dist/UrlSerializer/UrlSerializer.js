"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UrlSerializer=void 0;const Base_1=require("../Base"),utils_1=require("./utils");class UrlSerializer{_path;_params;_options;constructor(i,t=utils_1.defaultSerializeOptions,s={}){this._path=i,this._params=s,this._options=t,this.extend=this.extend.bind(this),this.setupParam=this.setupParam.bind(this),this.path=this.path.bind(this),this.param=this.param.bind(this),this.build=this.build.bind(this),this.link=this.link.bind(this),this.queries=this.queries.bind(this)}setupParam(i){if((0,Base_1.$Object)(this._params).get(i))throw new utils_1.UniqueParamException(i);this._params={...this._params,[":"+i]:i}}extend(i=void 0,t){return void 0===i&&"build"===t?new UrlSerializer(this._path,this._options,this._params):i&&"queries"===t||i&&"link"===t?new UrlSerializer(i,this._options,this._params):void 0}path(i){return this._path=this._path+"/"+i,this}param(i){return this.setupParam(i),this._path=this._path+"/:"+i,this}link(i){const t=(0,Base_1.$String)(this._path).replaceAll("/",i);return{path:t,extend:()=>this.extend(t,"link")}}queries(i,t){const s=(0,Base_1.$String)(this._path).joinQueryString((0,Base_1.$Object)(i).toQueries({...this._options,...t}));return{path:s,extend:()=>this.extend(s,"queries")}}build(){return{path:this._path,extend:()=>this.extend(void 0,"build"),link:this.link,queries:this.queries}}}exports.UrlSerializer=UrlSerializer;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlVybFNlcmlhbGl6ZXIvVXJsU2VyaWFsaXplci5qcyIsIi4uL3NyYy9VcmxTZXJpYWxpemVyL1VybFNlcmlhbGl6ZXIudHMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJCYXNlXzEiLCJyZXF1aXJlIiwidXRpbHNfMSIsIlVybFNlcmlhbGl6ZXIiLCJfcGF0aCIsIl9wYXJhbXMiLCJfb3B0aW9ucyIsImNvbnN0cnVjdG9yIiwicGF0aCIsIm9wdGlvbnMiLCJkZWZhdWx0U2VyaWFsaXplT3B0aW9ucyIsInBhcmFtcyIsInRoaXMiLCJleHRlbmQiLCJiaW5kIiwic2V0dXBQYXJhbSIsInBhcmFtIiwiYnVpbGQiLCJsaW5rIiwicXVlcmllcyIsImtleSIsIiRPYmplY3QiLCJnZXQiLCJVbmlxdWVQYXJhbUV4Y2VwdGlvbiIsInVuZGVmaW5lZCIsInR5cGUiLCIkU3RyaW5nIiwicmVwbGFjZUFsbCIsInF1ZXJpZXNPYmplY3QiLCJqb2luUXVlcnlTdHJpbmciLCJ0b1F1ZXJpZXMiXSwibWFwcGluZ3MiOiJBQUFBLGFBQ0FBLE9BQU9DLGVBQWVDLFFBQVMsYUFBYyxDQUFFQyxNQUFPLENBQUEsQ0FBSyxDQUFDLEVBQTVESCxRQUFPQyxjQUFlQyxLQUFBQSxFQ0R0QixNQUFBRSxPQUFBQyxRQUFBLFNBQUEsRUFDQUMsUUFBQUQsUUFBQSxTQUFBLFFBUU1FLGNBQ01DLE1BQ0FDLFFBQ0FDLFNBQ1JDLFlBQ0lDLEVBQ0FDLEVBQXlDUCxRQUFBUSx3QkFDekNDLEVBQWlCLElBRWpCQyxLQUFLUixNQUFRSSxFQUNiSSxLQUFLUCxRQUFVTSxFQUNmQyxLQUFLTixTQUFXRyxFQUNoQkcsS0FBS0MsT0FBU0QsS0FBS0MsT0FBT0MsS0FBS0YsSUFBSSxFQUNuQ0EsS0FBS0csV0FBYUgsS0FBS0csV0FBV0QsS0FBS0YsSUFBSSxFQUMzQ0EsS0FBS0osS0FBT0ksS0FBS0osS0FBS00sS0FBS0YsSUFBSSxFQUMvQkEsS0FBS0ksTUFBUUosS0FBS0ksTUFBTUYsS0FBS0YsSUFBSSxFQUNqQ0EsS0FBS0ssTUFBUUwsS0FBS0ssTUFBTUgsS0FBS0YsSUFBSSxFQUNqQ0EsS0FBS00sS0FBT04sS0FBS00sS0FBS0osS0FBS0YsSUFBSSxFQUMvQkEsS0FBS08sUUFBVVAsS0FBS08sUUFBUUwsS0FBS0YsSUFBSSxDQUN6QyxDQUVRRyxXQUErQkssR0FDbkMsSUFBSSxFQUFBcEIsT0FBQXFCLFNBQVFULEtBQUtQLE9BQU8sRUFBRWlCLElBQUlGLENBQUcsRUFDN0IsTUFBTSxJQUFJbEIsUUFBQXFCLHFCQUFxQkgsQ0FBRyxFQUV0Q1IsS0FBS1AsUUFBVSxDQUFFLEdBQUdPLEtBQUtQLFNBQVUsSUFBSWUsR0FBUUEsQ0FBRyxDQUN0RCxDQVFRUCxPQUNKTCxFQUEyRWdCLEtBQUFBLEVBQzNFQyxHQUVBLE9BQWFELEtBQUFBLElBQVRoQixHQUErQixVQUFUaUIsRUFDZixJQUFJdEIsY0FBNEJTLEtBQUtSLE1BQU9RLEtBQUtOLFNBQVVNLEtBQUtQLE9BQU8sRUFFOUVHLEdBQWlCLFlBQVRpQixHQUdSakIsR0FBaUIsU0FBVGlCLEVBQ0QsSUFBSXRCLGNBQ1BLLEVBQ0FJLEtBQUtOLFNBQ0xNLEtBQUtQLE9BQU8sRUFKcEIsS0FBQSxDQU9KLENBRU9HLEtBQXVCVCxHQUUxQixPQURBYSxLQUFLUixNQUFXUSxLQUFLUixNQUFSLElBQWlCTCxFQUN2QmEsSUFDWCxDQUVPSSxNQUEwQkksR0FHN0IsT0FGQVIsS0FBS0csV0FBV0ssQ0FBRyxFQUNuQlIsS0FBS1IsTUFBV1EsS0FBS1IsTUFBUixLQUFrQmdCLEVBQ3hCUixJQUNYLENBRVFNLEtBQXVCUCxHQUMzQixNQUFNSCxHQUFPLEVBQUFSLE9BQUEwQixTQUFRZCxLQUFLUixLQUFLLEVBQUV1QixXQUFXLElBQUtoQixDQUFNLEVBQ3ZELE1BQU8sQ0FDSEgsS0FBQUEsRUFDQUssT0FBUUEsSUFBTUQsS0FBS0MsT0FBT0wsRUFBTSxNQUFNLENBTjlDLENBUUEsQ0FFUVcsUUFDSlMsRUFDQW5CLEdBRUEsTUFBTUQsR0FBTyxFQUFBUixPQUFBMEIsU0FBUWQsS0FBS1IsS0FBSyxFQUFFeUIsaUJBQzdCLEVBQUE3QixPQUFBcUIsU0FBUU8sQ0FBYSxFQUFFRSxVQUFVLENBQzdCLEdBQUdsQixLQUFLTixTQUNSLEdBQUdHLENBVlYsQ0FXSSxDQUFDLEVBRU4sTUFBTyxDQUNIRCxLQUFBQSxFQUNBSyxPQUFRQSxJQUFNRCxLQUFLQyxPQUFPTCxFQUFNLFNBQVMsQ0FOckMsQ0FRWixDQUVPUyxRQUNILE1BQU8sQ0FDSFQsS0FBTUksS0FBS1IsTUFDWFMsT0FBUUEsSUFBTUQsS0FBS0MsT0FBT1csS0FBQUEsRUFBVyxPQUFPLEVBQzVDTixLQUFNTixLQUFLTSxLQUNYQyxRQUFTUCxLQUFLTyxPQUxWLENBT1osQ0RoQ0osQ0NtQ1NyQixRQUFBSyxjQUFBQSIsImZpbGUiOiJVcmxTZXJpYWxpemVyL1VybFNlcmlhbGl6ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVXJsU2VyaWFsaXplciA9IHZvaWQgMDtcbmNvbnN0IEJhc2VfMSA9IHJlcXVpcmUoXCIuLi9CYXNlXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuL3V0aWxzXCIpO1xuY2xhc3MgVXJsU2VyaWFsaXplciB7XG4gICAgX3BhdGg7XG4gICAgX3BhcmFtcztcbiAgICBfb3B0aW9ucztcbiAgICBjb25zdHJ1Y3RvcihwYXRoLCBvcHRpb25zID0gdXRpbHNfMS5kZWZhdWx0U2VyaWFsaXplT3B0aW9ucywgcGFyYW1zID0ge30pIHtcbiAgICAgICAgdGhpcy5fcGF0aCA9IHBhdGg7XG4gICAgICAgIHRoaXMuX3BhcmFtcyA9IHBhcmFtcztcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuZXh0ZW5kID0gdGhpcy5leHRlbmQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5zZXR1cFBhcmFtID0gdGhpcy5zZXR1cFBhcmFtLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMucGF0aCA9IHRoaXMucGF0aC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLnBhcmFtID0gdGhpcy5wYXJhbS5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmJ1aWxkID0gdGhpcy5idWlsZC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmxpbmsgPSB0aGlzLmxpbmsuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5xdWVyaWVzID0gdGhpcy5xdWVyaWVzLmJpbmQodGhpcyk7XG4gICAgfVxuICAgIHNldHVwUGFyYW0oa2V5KSB7XG4gICAgICAgIGlmICgoMCwgQmFzZV8xLiRPYmplY3QpKHRoaXMuX3BhcmFtcykuZ2V0KGtleSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyB1dGlsc18xLlVuaXF1ZVBhcmFtRXhjZXB0aW9uKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcGFyYW1zID0geyAuLi50aGlzLl9wYXJhbXMsIFtgOiR7a2V5fWBdOiBrZXkgfTtcbiAgICB9XG4gICAgZXh0ZW5kKHBhdGggPSB1bmRlZmluZWQsIHR5cGUpIHtcbiAgICAgICAgaWYgKHBhdGggPT09IHVuZGVmaW5lZCAmJiB0eXBlID09PSAnYnVpbGQnKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVybFNlcmlhbGl6ZXIodGhpcy5fcGF0aCwgdGhpcy5fb3B0aW9ucywgdGhpcy5fcGFyYW1zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGF0aCAmJiB0eXBlID09PSAncXVlcmllcycpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVXJsU2VyaWFsaXplcihwYXRoLCB0aGlzLl9vcHRpb25zLCB0aGlzLl9wYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXRoICYmIHR5cGUgPT09ICdsaW5rJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVcmxTZXJpYWxpemVyKHBhdGgsIHRoaXMuX29wdGlvbnMsIHRoaXMuX3BhcmFtcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcGF0aCh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9wYXRoID0gYCR7dGhpcy5fcGF0aH0vJHt2YWx1ZX1gO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgcGFyYW0oa2V5KSB7XG4gICAgICAgIHRoaXMuc2V0dXBQYXJhbShrZXkpO1xuICAgICAgICB0aGlzLl9wYXRoID0gYCR7dGhpcy5fcGF0aH0vOiR7a2V5fWA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBsaW5rKHBhcmFtcykge1xuICAgICAgICBjb25zdCBwYXRoID0gKDAsIEJhc2VfMS4kU3RyaW5nKSh0aGlzLl9wYXRoKS5yZXBsYWNlQWxsKCcvJywgcGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhdGgsXG4gICAgICAgICAgICBleHRlbmQ6ICgpID0+IHRoaXMuZXh0ZW5kKHBhdGgsICdsaW5rJyksXG4gICAgICAgIH07XG4gICAgfVxuICAgIHF1ZXJpZXMocXVlcmllc09iamVjdCwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCBwYXRoID0gKDAsIEJhc2VfMS4kU3RyaW5nKSh0aGlzLl9wYXRoKS5qb2luUXVlcnlTdHJpbmcoKDAsIEJhc2VfMS4kT2JqZWN0KShxdWVyaWVzT2JqZWN0KS50b1F1ZXJpZXMoe1xuICAgICAgICAgICAgLi4udGhpcy5fb3B0aW9ucyxcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhdGgsXG4gICAgICAgICAgICBleHRlbmQ6ICgpID0+IHRoaXMuZXh0ZW5kKHBhdGgsICdxdWVyaWVzJyksXG4gICAgICAgIH07XG4gICAgfVxuICAgIGJ1aWxkKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF0aDogdGhpcy5fcGF0aCxcbiAgICAgICAgICAgIGV4dGVuZDogKCkgPT4gdGhpcy5leHRlbmQodW5kZWZpbmVkLCAnYnVpbGQnKSxcbiAgICAgICAgICAgIGxpbms6IHRoaXMubGluayxcbiAgICAgICAgICAgIHF1ZXJpZXM6IHRoaXMucXVlcmllcyxcbiAgICAgICAgfTtcbiAgICB9XG59XG5leHBvcnRzLlVybFNlcmlhbGl6ZXIgPSBVcmxTZXJpYWxpemVyO1xuIiwiaW1wb3J0IHsgJE9iamVjdCwgJFN0cmluZywgVHlwZXMgfSBmcm9tICcuLi9CYXNlJ1xuaW1wb3J0IHtcbiAgICBkZWZhdWx0U2VyaWFsaXplT3B0aW9ucyxcbiAgICBVcmxTZXJpYWxpemVyT3B0aW9ucyxcbiAgICBVcmxTZXJpYWxpemVyUGFyYW1zLFxuICAgIFVybFNlcmlhbGl6ZXJRdWVyaWVzLFxuICAgIFVuaXF1ZVBhcmFtRXhjZXB0aW9uLFxufSBmcm9tICcuL3V0aWxzJ1xuXG5jbGFzcyBVcmxTZXJpYWxpemVyPFBhdGggZXh0ZW5kcyBzdHJpbmcsIFBhcmFtcyBleHRlbmRzIFVybFNlcmlhbGl6ZXJQYXJhbXM8c3RyaW5nPj4ge1xuICAgIHByaXZhdGUgX3BhdGg6IFBhdGhcbiAgICBwcml2YXRlIF9wYXJhbXM6IFBhcmFtc1xuICAgIHByaXZhdGUgX29wdGlvbnM6IFBhcnRpYWw8VXJsU2VyaWFsaXplck9wdGlvbnM+XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHBhdGg6IFBhdGgsXG4gICAgICAgIG9wdGlvbnM6IFBhcnRpYWw8VXJsU2VyaWFsaXplck9wdGlvbnM+ID0gZGVmYXVsdFNlcmlhbGl6ZU9wdGlvbnMsXG4gICAgICAgIHBhcmFtczogUGFyYW1zID0ge30gYXMgUGFyYW1zXG4gICAgKSB7XG4gICAgICAgIHRoaXMuX3BhdGggPSBwYXRoXG4gICAgICAgIHRoaXMuX3BhcmFtcyA9IHBhcmFtc1xuICAgICAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9uc1xuICAgICAgICB0aGlzLmV4dGVuZCA9IHRoaXMuZXh0ZW5kLmJpbmQodGhpcylcbiAgICAgICAgdGhpcy5zZXR1cFBhcmFtID0gdGhpcy5zZXR1cFBhcmFtLmJpbmQodGhpcylcbiAgICAgICAgdGhpcy5wYXRoID0gdGhpcy5wYXRoLmJpbmQodGhpcylcbiAgICAgICAgdGhpcy5wYXJhbSA9IHRoaXMucGFyYW0uYmluZCh0aGlzKVxuICAgICAgICB0aGlzLmJ1aWxkID0gdGhpcy5idWlsZC5iaW5kKHRoaXMpXG4gICAgICAgIHRoaXMubGluayA9IHRoaXMubGluay5iaW5kKHRoaXMpXG4gICAgICAgIHRoaXMucXVlcmllcyA9IHRoaXMucXVlcmllcy5iaW5kKHRoaXMpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXR1cFBhcmFtPEtleSBleHRlbmRzIHN0cmluZz4oa2V5OiBLZXkpIHtcbiAgICAgICAgaWYgKCRPYmplY3QodGhpcy5fcGFyYW1zKS5nZXQoa2V5KSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFVuaXF1ZVBhcmFtRXhjZXB0aW9uKGtleSlcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9wYXJhbXMgPSB7IC4uLnRoaXMuX3BhcmFtcywgW2A6JHtrZXl9YF06IGtleSB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBleHRlbmQocGF0aDogdW5kZWZpbmVkLCB0eXBlOiAnYnVpbGQnKTogVXJsU2VyaWFsaXplcjxQYXRoLCBQYXJhbXM+XG4gICAgcHJpdmF0ZSBleHRlbmQ8UCBleHRlbmRzIGAke3N0cmluZ30ke3N0cmluZ31gPihwYXRoOiBQLCB0eXBlOiAncXVlcmllcycpOiBVcmxTZXJpYWxpemVyPFAsIFBhcmFtcz5cbiAgICBwcml2YXRlIGV4dGVuZDxQIGV4dGVuZHMgUGFyYW1zPihcbiAgICAgICAgcGF0aDogVHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UGF0aCwgUD4sXG4gICAgICAgIHR5cGU6ICdsaW5rJ1xuICAgICk6IFVybFNlcmlhbGl6ZXI8VHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UGF0aCwgUD4sIE9taXQ8UGFyYW1zLCBrZXlvZiBQPj5cbiAgICBwcml2YXRlIGV4dGVuZDxQIGV4dGVuZHMgUGFyYW1zPihcbiAgICAgICAgcGF0aDogVHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UGF0aCwgUD4gfCBgJHtQYXRofT8ke3N0cmluZ31gIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkLFxuICAgICAgICB0eXBlOiAnYnVpbGQnIHwgJ3F1ZXJpZXMnIHwgJ2xpbmsnXG4gICAgKSB7XG4gICAgICAgIGlmIChwYXRoID09PSB1bmRlZmluZWQgJiYgdHlwZSA9PT0gJ2J1aWxkJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVcmxTZXJpYWxpemVyPFBhdGgsIFBhcmFtcz4odGhpcy5fcGF0aCwgdGhpcy5fb3B0aW9ucywgdGhpcy5fcGFyYW1zKVxuICAgICAgICB9XG4gICAgICAgIGlmIChwYXRoICYmIHR5cGUgPT09ICdxdWVyaWVzJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVcmxTZXJpYWxpemVyPGAke1BhdGh9PyR7c3RyaW5nfWAsIFBhcmFtcz4ocGF0aCwgdGhpcy5fb3B0aW9ucywgdGhpcy5fcGFyYW1zKVxuICAgICAgICB9XG4gICAgICAgIGlmIChwYXRoICYmIHR5cGUgPT09ICdsaW5rJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVcmxTZXJpYWxpemVyPFR5cGVzLlN0cmluZy5SZXBsYWNlQWxsPFBhdGgsIFA+LCBPbWl0PFBhcmFtcywga2V5b2YgUD4+KFxuICAgICAgICAgICAgICAgIHBhdGggYXMgVHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UGF0aCwgUD4sXG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucyxcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXNcbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBwYXRoPFQgZXh0ZW5kcyBzdHJpbmc+KHZhbHVlOiBUKSB7XG4gICAgICAgIHRoaXMuX3BhdGggPSBgJHt0aGlzLl9wYXRofS8ke3ZhbHVlfWAgYXMgUGF0aFxuICAgICAgICByZXR1cm4gdGhpcyBhcyB1bmtub3duIGFzIFVybFNlcmlhbGl6ZXI8YCR7UGF0aH0vJHtUfWAsIFBhcmFtcz5cbiAgICB9XG5cbiAgICBwdWJsaWMgcGFyYW08S2V5IGV4dGVuZHMgc3RyaW5nPihrZXk6IEtleSkge1xuICAgICAgICB0aGlzLnNldHVwUGFyYW0oa2V5KVxuICAgICAgICB0aGlzLl9wYXRoID0gYCR7dGhpcy5fcGF0aH0vOiR7a2V5fWAgYXMgUGF0aFxuICAgICAgICByZXR1cm4gdGhpcyBhcyB1bmtub3duIGFzIFVybFNlcmlhbGl6ZXI8YCR7UGF0aH0vOiR7S2V5fWAsIFBhcmFtcyAmIFVybFNlcmlhbGl6ZXJQYXJhbXM8S2V5Pj5cbiAgICB9XG5cbiAgICBwcml2YXRlIGxpbms8UCBleHRlbmRzIFBhcmFtcz4ocGFyYW1zOiBQKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSAkU3RyaW5nKHRoaXMuX3BhdGgpLnJlcGxhY2VBbGwoJy8nLCBwYXJhbXMpXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAgZXh0ZW5kOiAoKSA9PiB0aGlzLmV4dGVuZChwYXRoLCAnbGluaycpLFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBxdWVyaWVzPFF1ZXJpZXMgZXh0ZW5kcyBVcmxTZXJpYWxpemVyUXVlcmllcz4oXG4gICAgICAgIHF1ZXJpZXNPYmplY3Q6IFF1ZXJpZXMsXG4gICAgICAgIG9wdGlvbnM/OiBQYXJ0aWFsPFVybFNlcmlhbGl6ZXJPcHRpb25zPlxuICAgICkge1xuICAgICAgICBjb25zdCBwYXRoID0gJFN0cmluZyh0aGlzLl9wYXRoKS5qb2luUXVlcnlTdHJpbmcoXG4gICAgICAgICAgICAkT2JqZWN0KHF1ZXJpZXNPYmplY3QpLnRvUXVlcmllcyh7XG4gICAgICAgICAgICAgICAgLi4udGhpcy5fb3B0aW9ucyxcbiAgICAgICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF0aCxcbiAgICAgICAgICAgIGV4dGVuZDogKCkgPT4gdGhpcy5leHRlbmQocGF0aCwgJ3F1ZXJpZXMnKSxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBidWlsZCgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhdGg6IHRoaXMuX3BhdGgsXG4gICAgICAgICAgICBleHRlbmQ6ICgpID0+IHRoaXMuZXh0ZW5kKHVuZGVmaW5lZCwgJ2J1aWxkJyksXG4gICAgICAgICAgICBsaW5rOiB0aGlzLmxpbmssXG4gICAgICAgICAgICBxdWVyaWVzOiB0aGlzLnF1ZXJpZXMsXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCB7IFVybFNlcmlhbGl6ZXIgfVxuIl19
