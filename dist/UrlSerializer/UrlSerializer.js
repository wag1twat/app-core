"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UrlSerializer=void 0;const Base_1=require("../Base"),utils_1=require("./utils");class UrlSerializer{_path;_params;_options;constructor(t,i=utils_1.defaultSerializeOptions,s={}){this._path=t,this._params=s,this._options=i,this.extend=this.extend.bind(this),this.setupParam=this.setupParam.bind(this),this.path=this.path.bind(this),this.param=this.param.bind(this),this.build=this.build.bind(this),this.link=this.link.bind(this),this.queries=this.queries.bind(this)}setupParam(t){if(Base_1.Base.Object(this._params).get(t))throw new utils_1.UniqueParamException(t);this._params={...this._params,[":"+t]:t}}extend(t=void 0,i){return void 0===t&&"build"===i?new UrlSerializer(this._path,this._options,this._params):t&&"queries"===i||t&&"link"===i?new UrlSerializer(t,this._options,this._params):void 0}path(t){return this._path=this._path+"/"+t,this}param(t){return this.setupParam(t),this._path=this._path+"/:"+t,this}link(t){const i=Base_1.Base.String(this._path).replaceAllSeparatedString("/",t);return{path:i,extend:()=>this.extend(i,"link")}}queries(t,i){const s=Base_1.Base.String(this._path).joinQueryString(Base_1.Base.Object(t).toQueries({...this._options,...i}));return{path:s,extend:()=>this.extend(s,"queries")}}build(){return{path:this._path,extend:()=>this.extend(void 0,"build"),link:this.link,queries:this.queries}}}exports.UrlSerializer=UrlSerializer;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlVybFNlcmlhbGl6ZXIvVXJsU2VyaWFsaXplci5qcyIsIi4uL3NyYy9VcmxTZXJpYWxpemVyL1VybFNlcmlhbGl6ZXIudHMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJCYXNlXzEiLCJyZXF1aXJlIiwidXRpbHNfMSIsIlVybFNlcmlhbGl6ZXIiLCJfcGF0aCIsIl9wYXJhbXMiLCJfb3B0aW9ucyIsImNvbnN0cnVjdG9yIiwicGF0aCIsIm9wdGlvbnMiLCJkZWZhdWx0U2VyaWFsaXplT3B0aW9ucyIsInBhcmFtcyIsInRoaXMiLCJleHRlbmQiLCJiaW5kIiwic2V0dXBQYXJhbSIsInBhcmFtIiwiYnVpbGQiLCJsaW5rIiwicXVlcmllcyIsImtleSIsIkJhc2UiLCJnZXQiLCJVbmlxdWVQYXJhbUV4Y2VwdGlvbiIsInVuZGVmaW5lZCIsInR5cGUiLCJTdHJpbmciLCJyZXBsYWNlQWxsU2VwYXJhdGVkU3RyaW5nIiwicXVlcmllc09iamVjdCIsImpvaW5RdWVyeVN0cmluZyIsInRvUXVlcmllcyJdLCJtYXBwaW5ncyI6IkFBQUEsYUFDQUEsT0FBT0MsZUFBZUMsUUFBUyxhQUFjLENBQUVDLE1BQU8sQ0FBQSxDQUFLLENBQUMsRUFBNURILFFBQU9DLGNBQWVDLEtBQUFBLEVDRHRCLE1BQUFFLE9BQUFDLFFBQUEsU0FBQSxFQUNBQyxRQUFBRCxRQUFBLFNBQUEsUUFRTUUsY0FJTUMsTUFDQUMsUUFDQUMsU0FDUkMsWUFDSUMsRUFDQUMsRUFBeUNQLFFBQUFRLHdCQUN6Q0MsRUFBaUIsSUFFakJDLEtBQUtSLE1BQVFJLEVBQ2JJLEtBQUtQLFFBQVVNLEVBQ2ZDLEtBQUtOLFNBQVdHLEVBQ2hCRyxLQUFLQyxPQUFTRCxLQUFLQyxPQUFPQyxLQUFLRixJQUFJLEVBQ25DQSxLQUFLRyxXQUFhSCxLQUFLRyxXQUFXRCxLQUFLRixJQUFJLEVBQzNDQSxLQUFLSixLQUFPSSxLQUFLSixLQUFLTSxLQUFLRixJQUFJLEVBQy9CQSxLQUFLSSxNQUFRSixLQUFLSSxNQUFNRixLQUFLRixJQUFJLEVBQ2pDQSxLQUFLSyxNQUFRTCxLQUFLSyxNQUFNSCxLQUFLRixJQUFJLEVBQ2pDQSxLQUFLTSxLQUFPTixLQUFLTSxLQUFLSixLQUFLRixJQUFJLEVBQy9CQSxLQUFLTyxRQUFVUCxLQUFLTyxRQUFRTCxLQUFLRixJQUFJLENBQ3pDLENBRVFHLFdBQStCSyxHQUNuQyxHQUFJcEIsT0FBQXFCLEtBQUt6QixPQUFPZ0IsS0FBS1AsT0FBTyxFQUFFaUIsSUFBSUYsQ0FBRyxFQUNqQyxNQUFNLElBQUlsQixRQUFBcUIscUJBQXFCSCxDQUFHLEVBRXRDUixLQUFLUCxRQUFVLENBQUUsR0FBR08sS0FBS1AsU0FBVSxJQUFJZSxHQUFRQSxDQUFHLENBQ3RELENBV1FQLE9BQ0pMLEVBR2tCZ0IsS0FBQUEsRUFDbEJDLEdBRUEsT0FBYUQsS0FBQUEsSUFBVGhCLEdBQStCLFVBQVRpQixFQUNmLElBQUl0QixjQUNQUyxLQUFLUixNQUNMUSxLQUFLTixTQUNMTSxLQUFLUCxPQUFPLEVBR2hCRyxHQUFpQixZQUFUaUIsR0FPUmpCLEdBQWlCLFNBQVRpQixFQUNELElBQUl0QixjQUlQSyxFQUNBSSxLQUFLTixTQUNMTSxLQUFLUCxPQUFPLEVBUHBCLEtBQUEsQ0FVSixDQUVPRyxLQUF1QlQsR0FFMUIsT0FEQWEsS0FBS1IsTUFBV1EsS0FBS1IsTUFBUixJQUFpQkwsRUFDdkJhLElBQ1gsQ0FFT0ksTUFBMEJJLEdBRzdCLE9BRkFSLEtBQUtHLFdBQVdLLENBQUcsRUFDbkJSLEtBQUtSLE1BQVdRLEtBQUtSLE1BQVIsS0FBa0JnQixFQUN4QlIsSUFJWCxDQUVRTSxLQUF1QlAsR0FDM0IsTUFBTUgsRUFBT1IsT0FBQXFCLEtBQUtLLE9BQU9kLEtBQUtSLEtBQUssRUFBRXVCLDBCQUNqQyxJQUNBaEIsQ0FBTSxFQUVWLE1BQU8sQ0FDSEgsS0FBQUEsRUFDQUssT0FBUUEsSUFBTUQsS0FBS0MsT0FBT0wsRUFBTSxNQUFNLENBVDlDLENBV0EsQ0FFUVcsUUFDSlMsRUFDQW5CLEdBRUEsTUFBTUQsRUFBT1IsT0FBQXFCLEtBQUtLLE9BQU9kLEtBQUtSLEtBQUssRUFBRXlCLGdCQUNqQzdCLE9BQUFxQixLQUFLekIsT0FBT2dDLENBQWEsRUFBRUUsVUFBVSxDQUNqQyxHQUFHbEIsS0FBS04sU0FDUixHQUFHRyxDQVZWLENBV0ksQ0FBQyxFQUVOLE1BQU8sQ0FDSEQsS0FBQUEsRUFDQUssT0FBUUEsSUFBTUQsS0FBS0MsT0FBT0wsRUFBTSxTQUFTLENBTnJDLENBUVosQ0FFT1MsUUFDSCxNQUFPLENBQ0hULEtBQU1JLEtBQUtSLE1BQ1hTLE9BQVFBLElBQU1ELEtBQUtDLE9BQU9XLEtBQUFBLEVBQVcsT0FBTyxFQUM1Q04sS0FBTU4sS0FBS00sS0FDWEMsUUFBU1AsS0FBS08sT0FMVixDQU9aLENEMURKLENDNkRTckIsUUFBQUssY0FBQUEiLCJmaWxlIjoiVXJsU2VyaWFsaXplci9VcmxTZXJpYWxpemVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlVybFNlcmlhbGl6ZXIgPSB2b2lkIDA7XG5jb25zdCBCYXNlXzEgPSByZXF1aXJlKFwiLi4vQmFzZVwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcbmNsYXNzIFVybFNlcmlhbGl6ZXIge1xuICAgIF9wYXRoO1xuICAgIF9wYXJhbXM7XG4gICAgX29wdGlvbnM7XG4gICAgY29uc3RydWN0b3IocGF0aCwgb3B0aW9ucyA9IHV0aWxzXzEuZGVmYXVsdFNlcmlhbGl6ZU9wdGlvbnMsIHBhcmFtcyA9IHt9KSB7XG4gICAgICAgIHRoaXMuX3BhdGggPSBwYXRoO1xuICAgICAgICB0aGlzLl9wYXJhbXMgPSBwYXJhbXM7XG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmV4dGVuZCA9IHRoaXMuZXh0ZW5kLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuc2V0dXBQYXJhbSA9IHRoaXMuc2V0dXBQYXJhbS5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLnBhdGggPSB0aGlzLnBhdGguYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5wYXJhbSA9IHRoaXMucGFyYW0uYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5idWlsZCA9IHRoaXMuYnVpbGQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5saW5rID0gdGhpcy5saW5rLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMucXVlcmllcyA9IHRoaXMucXVlcmllcy5iaW5kKHRoaXMpO1xuICAgIH1cbiAgICBzZXR1cFBhcmFtKGtleSkge1xuICAgICAgICBpZiAoQmFzZV8xLkJhc2UuT2JqZWN0KHRoaXMuX3BhcmFtcykuZ2V0KGtleSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyB1dGlsc18xLlVuaXF1ZVBhcmFtRXhjZXB0aW9uKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcGFyYW1zID0geyAuLi50aGlzLl9wYXJhbXMsIFtgOiR7a2V5fWBdOiBrZXkgfTtcbiAgICB9XG4gICAgZXh0ZW5kKHBhdGggPSB1bmRlZmluZWQsIHR5cGUpIHtcbiAgICAgICAgaWYgKHBhdGggPT09IHVuZGVmaW5lZCAmJiB0eXBlID09PSAnYnVpbGQnKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVybFNlcmlhbGl6ZXIodGhpcy5fcGF0aCwgdGhpcy5fb3B0aW9ucywgdGhpcy5fcGFyYW1zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGF0aCAmJiB0eXBlID09PSAncXVlcmllcycpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVXJsU2VyaWFsaXplcihwYXRoLCB0aGlzLl9vcHRpb25zLCB0aGlzLl9wYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXRoICYmIHR5cGUgPT09ICdsaW5rJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVcmxTZXJpYWxpemVyKHBhdGgsIHRoaXMuX29wdGlvbnMsIHRoaXMuX3BhcmFtcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcGF0aCh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9wYXRoID0gYCR7dGhpcy5fcGF0aH0vJHt2YWx1ZX1gO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgcGFyYW0oa2V5KSB7XG4gICAgICAgIHRoaXMuc2V0dXBQYXJhbShrZXkpO1xuICAgICAgICB0aGlzLl9wYXRoID0gYCR7dGhpcy5fcGF0aH0vOiR7a2V5fWA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBsaW5rKHBhcmFtcykge1xuICAgICAgICBjb25zdCBwYXRoID0gQmFzZV8xLkJhc2UuU3RyaW5nKHRoaXMuX3BhdGgpLnJlcGxhY2VBbGxTZXBhcmF0ZWRTdHJpbmcoJy8nLCBwYXJhbXMpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF0aCxcbiAgICAgICAgICAgIGV4dGVuZDogKCkgPT4gdGhpcy5leHRlbmQocGF0aCwgJ2xpbmsnKSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcXVlcmllcyhxdWVyaWVzT2JqZWN0LCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSBCYXNlXzEuQmFzZS5TdHJpbmcodGhpcy5fcGF0aCkuam9pblF1ZXJ5U3RyaW5nKEJhc2VfMS5CYXNlLk9iamVjdChxdWVyaWVzT2JqZWN0KS50b1F1ZXJpZXMoe1xuICAgICAgICAgICAgLi4udGhpcy5fb3B0aW9ucyxcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhdGgsXG4gICAgICAgICAgICBleHRlbmQ6ICgpID0+IHRoaXMuZXh0ZW5kKHBhdGgsICdxdWVyaWVzJyksXG4gICAgICAgIH07XG4gICAgfVxuICAgIGJ1aWxkKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF0aDogdGhpcy5fcGF0aCxcbiAgICAgICAgICAgIGV4dGVuZDogKCkgPT4gdGhpcy5leHRlbmQodW5kZWZpbmVkLCAnYnVpbGQnKSxcbiAgICAgICAgICAgIGxpbms6IHRoaXMubGluayxcbiAgICAgICAgICAgIHF1ZXJpZXM6IHRoaXMucXVlcmllcyxcbiAgICAgICAgfTtcbiAgICB9XG59XG5leHBvcnRzLlVybFNlcmlhbGl6ZXIgPSBVcmxTZXJpYWxpemVyO1xuIiwiaW1wb3J0IHsgQmFzZSwgVHlwZXMgfSBmcm9tICcuLi9CYXNlJ1xuaW1wb3J0IHtcbiAgICBkZWZhdWx0U2VyaWFsaXplT3B0aW9ucyxcbiAgICBVcmxTZXJpYWxpemVyT3B0aW9ucyxcbiAgICBVcmxTZXJpYWxpemVyUGFyYW1zLFxuICAgIFVybFNlcmlhbGl6ZXJRdWVyaWVzLFxuICAgIFVuaXF1ZVBhcmFtRXhjZXB0aW9uLFxufSBmcm9tICcuL3V0aWxzJ1xuXG5jbGFzcyBVcmxTZXJpYWxpemVyPFxuICAgIFBhdGggZXh0ZW5kcyBzdHJpbmcsXG4gICAgUGFyYW1zIGV4dGVuZHMgVXJsU2VyaWFsaXplclBhcmFtczxzdHJpbmc+XG4+IHtcbiAgICBwcml2YXRlIF9wYXRoOiBQYXRoXG4gICAgcHJpdmF0ZSBfcGFyYW1zOiBQYXJhbXNcbiAgICBwcml2YXRlIF9vcHRpb25zOiBQYXJ0aWFsPFVybFNlcmlhbGl6ZXJPcHRpb25zPlxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwYXRoOiBQYXRoLFxuICAgICAgICBvcHRpb25zOiBQYXJ0aWFsPFVybFNlcmlhbGl6ZXJPcHRpb25zPiA9IGRlZmF1bHRTZXJpYWxpemVPcHRpb25zLFxuICAgICAgICBwYXJhbXM6IFBhcmFtcyA9IHt9IGFzIFBhcmFtc1xuICAgICkge1xuICAgICAgICB0aGlzLl9wYXRoID0gcGF0aFxuICAgICAgICB0aGlzLl9wYXJhbXMgPSBwYXJhbXNcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnNcbiAgICAgICAgdGhpcy5leHRlbmQgPSB0aGlzLmV4dGVuZC5iaW5kKHRoaXMpXG4gICAgICAgIHRoaXMuc2V0dXBQYXJhbSA9IHRoaXMuc2V0dXBQYXJhbS5iaW5kKHRoaXMpXG4gICAgICAgIHRoaXMucGF0aCA9IHRoaXMucGF0aC5iaW5kKHRoaXMpXG4gICAgICAgIHRoaXMucGFyYW0gPSB0aGlzLnBhcmFtLmJpbmQodGhpcylcbiAgICAgICAgdGhpcy5idWlsZCA9IHRoaXMuYnVpbGQuYmluZCh0aGlzKVxuICAgICAgICB0aGlzLmxpbmsgPSB0aGlzLmxpbmsuYmluZCh0aGlzKVxuICAgICAgICB0aGlzLnF1ZXJpZXMgPSB0aGlzLnF1ZXJpZXMuYmluZCh0aGlzKVxuICAgIH1cblxuICAgIHByaXZhdGUgc2V0dXBQYXJhbTxLZXkgZXh0ZW5kcyBzdHJpbmc+KGtleTogS2V5KSB7XG4gICAgICAgIGlmIChCYXNlLk9iamVjdCh0aGlzLl9wYXJhbXMpLmdldChrZXkpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVW5pcXVlUGFyYW1FeGNlcHRpb24oa2V5KVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3BhcmFtcyA9IHsgLi4udGhpcy5fcGFyYW1zLCBbYDoke2tleX1gXToga2V5IH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGV4dGVuZChwYXRoOiB1bmRlZmluZWQsIHR5cGU6ICdidWlsZCcpOiBVcmxTZXJpYWxpemVyPFBhdGgsIFBhcmFtcz5cbiAgICBwcml2YXRlIGV4dGVuZDxQIGV4dGVuZHMgYCR7c3RyaW5nfSR7c3RyaW5nfWA+KFxuICAgICAgICBwYXRoOiBQLFxuICAgICAgICB0eXBlOiAncXVlcmllcydcbiAgICApOiBVcmxTZXJpYWxpemVyPFAsIFBhcmFtcz5cbiAgICBwcml2YXRlIGV4dGVuZDxQIGV4dGVuZHMgUGFyYW1zPihcbiAgICAgICAgcGF0aDogVHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UGF0aCwgUD4sXG4gICAgICAgIHR5cGU6ICdsaW5rJ1xuICAgICk6IFVybFNlcmlhbGl6ZXI8VHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UGF0aCwgUD4sIE9taXQ8UGFyYW1zLCBrZXlvZiBQPj5cbiAgICBwcml2YXRlIGV4dGVuZDxQIGV4dGVuZHMgUGFyYW1zPihcbiAgICAgICAgcGF0aDpcbiAgICAgICAgICAgIHwgVHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UGF0aCwgUD5cbiAgICAgICAgICAgIHwgYCR7UGF0aH0/JHtzdHJpbmd9YFxuICAgICAgICAgICAgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQsXG4gICAgICAgIHR5cGU6ICdidWlsZCcgfCAncXVlcmllcycgfCAnbGluaydcbiAgICApIHtcbiAgICAgICAgaWYgKHBhdGggPT09IHVuZGVmaW5lZCAmJiB0eXBlID09PSAnYnVpbGQnKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVybFNlcmlhbGl6ZXI8UGF0aCwgUGFyYW1zPihcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXRoLFxuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMsXG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zXG4gICAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhdGggJiYgdHlwZSA9PT0gJ3F1ZXJpZXMnKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVybFNlcmlhbGl6ZXI8YCR7UGF0aH0/JHtzdHJpbmd9YCwgUGFyYW1zPihcbiAgICAgICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMsXG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zXG4gICAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhdGggJiYgdHlwZSA9PT0gJ2xpbmsnKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVybFNlcmlhbGl6ZXI8XG4gICAgICAgICAgICAgICAgVHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UGF0aCwgUD4sXG4gICAgICAgICAgICAgICAgT21pdDxQYXJhbXMsIGtleW9mIFA+XG4gICAgICAgICAgICA+KFxuICAgICAgICAgICAgICAgIHBhdGggYXMgVHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UGF0aCwgUD4sXG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucyxcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXNcbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBwYXRoPFQgZXh0ZW5kcyBzdHJpbmc+KHZhbHVlOiBUKSB7XG4gICAgICAgIHRoaXMuX3BhdGggPSBgJHt0aGlzLl9wYXRofS8ke3ZhbHVlfWAgYXMgUGF0aFxuICAgICAgICByZXR1cm4gdGhpcyBhcyB1bmtub3duIGFzIFVybFNlcmlhbGl6ZXI8YCR7UGF0aH0vJHtUfWAsIFBhcmFtcz5cbiAgICB9XG5cbiAgICBwdWJsaWMgcGFyYW08S2V5IGV4dGVuZHMgc3RyaW5nPihrZXk6IEtleSkge1xuICAgICAgICB0aGlzLnNldHVwUGFyYW0oa2V5KVxuICAgICAgICB0aGlzLl9wYXRoID0gYCR7dGhpcy5fcGF0aH0vOiR7a2V5fWAgYXMgUGF0aFxuICAgICAgICByZXR1cm4gdGhpcyBhcyB1bmtub3duIGFzIFVybFNlcmlhbGl6ZXI8XG4gICAgICAgICAgICBgJHtQYXRofS86JHtLZXl9YCxcbiAgICAgICAgICAgIFBhcmFtcyAmIFVybFNlcmlhbGl6ZXJQYXJhbXM8S2V5PlxuICAgICAgICA+XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBsaW5rPFAgZXh0ZW5kcyBQYXJhbXM+KHBhcmFtczogUCkge1xuICAgICAgICBjb25zdCBwYXRoID0gQmFzZS5TdHJpbmcodGhpcy5fcGF0aCkucmVwbGFjZUFsbFNlcGFyYXRlZFN0cmluZyhcbiAgICAgICAgICAgICcvJyxcbiAgICAgICAgICAgIHBhcmFtc1xuICAgICAgICApXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAgZXh0ZW5kOiAoKSA9PiB0aGlzLmV4dGVuZChwYXRoLCAnbGluaycpLFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBxdWVyaWVzPFF1ZXJpZXMgZXh0ZW5kcyBVcmxTZXJpYWxpemVyUXVlcmllcz4oXG4gICAgICAgIHF1ZXJpZXNPYmplY3Q6IFF1ZXJpZXMsXG4gICAgICAgIG9wdGlvbnM/OiBQYXJ0aWFsPFVybFNlcmlhbGl6ZXJPcHRpb25zPlxuICAgICkge1xuICAgICAgICBjb25zdCBwYXRoID0gQmFzZS5TdHJpbmcodGhpcy5fcGF0aCkuam9pblF1ZXJ5U3RyaW5nKFxuICAgICAgICAgICAgQmFzZS5PYmplY3QocXVlcmllc09iamVjdCkudG9RdWVyaWVzKHtcbiAgICAgICAgICAgICAgICAuLi50aGlzLl9vcHRpb25zLFxuICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAgZXh0ZW5kOiAoKSA9PiB0aGlzLmV4dGVuZChwYXRoLCAncXVlcmllcycpLFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGJ1aWxkKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF0aDogdGhpcy5fcGF0aCxcbiAgICAgICAgICAgIGV4dGVuZDogKCkgPT4gdGhpcy5leHRlbmQodW5kZWZpbmVkLCAnYnVpbGQnKSxcbiAgICAgICAgICAgIGxpbms6IHRoaXMubGluayxcbiAgICAgICAgICAgIHF1ZXJpZXM6IHRoaXMucXVlcmllcyxcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgVXJsU2VyaWFsaXplciB9XG4iXX0=
