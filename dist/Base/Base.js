"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Base=void 0;const Guards_1=require("../Guards"),rules_1=require("./rules"),Types_1=require("./Types");var Base;!function(o){o.Object=function a(p){function d(e){return p[e]}return{get:d,toQueries:function(s=Types_1.Types.Object.defaultToQueriesOptions,r){var t,{skipNull:e,skipUndefined:u}=s;let n=[];for(t in p)if(p.hasOwnProperty(t)){var o,i,c=d(t);if(!(!0===e&&Guards_1.Guards.isNull(c)||!0===u&&Guards_1.Guards.isUndefined(c))){let e=t;Guards_1.Guards.isArrayConstructor(p)?([o,i]=Types_1.Types.Object.toQueriesAccsessors[s.arrayAccsessor||Types_1.Types.Object.defaultToQueriesOptions.arrayAccsessor],e=""+r+o+i):Guards_1.Guards.isObjectConstructor(p)&&([o,i]=Types_1.Types.Object.toQueriesAccsessors[s.objectAccsessor||Types_1.Types.Object.defaultToQueriesOptions.objectAccsessor],e=r?""+r+o+e+i:e),Guards_1.Guards.isTypeofObject(c)?n.push(a(c).toQueries(s,e)):n.push(e+"="+encodeURIComponent(""+c))}}return n=n.filter(rules_1.nonEmptyString),(n=[].concat.apply([],n)).length?n.join("&"):""}}},o.String=function(r){function s(){return-1!==(""+r).indexOf("?")}function n(e,s){return(""+r).split(e,s)}return{split:n,replaceAllSeparatedString:function(e,s){var r=[],t=n(e);for(let e=0;e<t.length;e++){var u=o.Object(s).get(t[e]);o.Object(s).get(t[e])?r.push(u):r.push(t[e])}return r.join(e)},hasQueryParams:s,joinQueryString:function(e){return s()?r+"&"+e:r+"?"+e}}}}(Base=Base||{}),exports.Base=Base;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJhc2UvQmFzZS5qcyIsIi4uL3NyYy9CYXNlL0Jhc2UudHMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJHdWFyZHNfMSIsInJlcXVpcmUiLCJydWxlc18xIiwiVHlwZXNfMSIsIkJhc2UiLCJvYmoiLCJnZXQiLCJrZXkiLCJ0b1F1ZXJpZXMiLCJvcHRpb25zIiwiVHlwZXMiLCJkZWZhdWx0VG9RdWVyaWVzT3B0aW9ucyIsInByZWZpeCIsInNraXBOdWxsIiwic2tpcFVuZGVmaW5lZCIsImxldCIsInJlc3VsdCIsImhhc093blByb3BlcnR5IiwicHJlIiwicG9zdCIsIkd1YXJkcyIsImlzTnVsbCIsImlzVW5kZWZpbmVkIiwiYWNjc2Vzc29yIiwiaXNBcnJheUNvbnN0cnVjdG9yIiwidG9RdWVyaWVzQWNjc2Vzc29ycyIsImFycmF5QWNjc2Vzc29yIiwiaXNPYmplY3RDb25zdHJ1Y3RvciIsIm9iamVjdEFjY3Nlc3NvciIsImlzVHlwZW9mT2JqZWN0IiwicHVzaCIsImVuY29kZVVSSUNvbXBvbmVudCIsImZpbHRlciIsIm5vbkVtcHR5U3RyaW5nIiwiY29uY2F0IiwiYXBwbHkiLCJsZW5ndGgiLCJqb2luIiwiU3RyaW5nIiwic3RyaW5nIiwiaGFzUXVlcnlQYXJhbXMiLCJpbmRleE9mIiwic3BsaXQiLCJzZXBhcmF0b3IiLCJsaW1pdCIsInJlcGxhY2VBbGxTZXBhcmF0ZWRTdHJpbmciLCJwcm9wZXJ0aWVzIiwicGFydHMiLCJpIiwicHJvcGVydHkiLCJqb2luUXVlcnlTdHJpbmciLCJxdWVyeVN0cmluZyJdLCJtYXBwaW5ncyI6IkFBQUEsYUFDQUEsT0FBT0MsZUFBZUMsUUFBUyxhQUFjLENBQUVDLE1BQU8sQ0FBQSxDQUFLLENBQUMsRUFBNURILFFBQU9DLEtBQUFBLEtBQUFBLEVDRFAsTUFBQUcsU0FBQUMsUUFBQSxXQUFBLEVBQ0FDLFFBQUFELFFBQUEsU0FBQSxFQUNBRSxRQUFBRixRQUFBLFNB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YXNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkJhc2UgPSB2b2lkIDA7XG5jb25zdCBHdWFyZHNfMSA9IHJlcXVpcmUoXCIuLi9HdWFyZHNcIik7XG5jb25zdCBydWxlc18xID0gcmVxdWlyZShcIi4vcnVsZXNcIik7XG5jb25zdCBUeXBlc18xID0gcmVxdWlyZShcIi4vVHlwZXNcIik7XG52YXIgQmFzZTtcbihmdW5jdGlvbiAoQmFzZSkge1xuICAgIGZ1bmN0aW9uIE9iamVjdChvYmopIHtcbiAgICAgICAgZnVuY3Rpb24gZ2V0KGtleSkge1xuICAgICAgICAgICAgcmV0dXJuIG9ialtrZXldO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHRvUXVlcmllcyhvcHRpb25zID0gVHlwZXNfMS5UeXBlcy5PYmplY3RcbiAgICAgICAgICAgIC5kZWZhdWx0VG9RdWVyaWVzT3B0aW9ucywgcHJlZml4KSB7XG4gICAgICAgICAgICBjb25zdCB7IHNraXBOdWxsLCBza2lwVW5kZWZpbmVkIH0gPSBvcHRpb25zO1xuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIG9iaikge1xuICAgICAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGdldChrZXkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2tpcE51bGwgPT09IHRydWUgJiYgR3VhcmRzXzEuR3VhcmRzLmlzTnVsbCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNraXBVbmRlZmluZWQgPT09IHRydWUgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIEd1YXJkc18xLkd1YXJkcy5pc1VuZGVmaW5lZCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGxldCBhY2NzZXNzb3IgPSBrZXk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChHdWFyZHNfMS5HdWFyZHMuaXNBcnJheUNvbnN0cnVjdG9yKG9iaikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFtwcmUsIHBvc3RdID0gVHlwZXNfMS5UeXBlcy5PYmplY3QudG9RdWVyaWVzQWNjc2Vzc29yc1tvcHRpb25zLmFycmF5QWNjc2Vzc29yIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZXNfMS5UeXBlcy5PYmplY3QuZGVmYXVsdFRvUXVlcmllc09wdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFycmF5QWNjc2Vzc29yXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY3Nlc3NvciA9IGAke3ByZWZpeH0ke3ByZX0ke3Bvc3R9YDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChHdWFyZHNfMS5HdWFyZHMuaXNPYmplY3RDb25zdHJ1Y3RvcihvYmopKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBbcHJlLCBwb3N0XSA9IFR5cGVzXzEuVHlwZXMuT2JqZWN0LnRvUXVlcmllc0FjY3Nlc3NvcnNbb3B0aW9ucy5vYmplY3RBY2NzZXNzb3IgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUeXBlc18xLlR5cGVzLk9iamVjdC5kZWZhdWx0VG9RdWVyaWVzT3B0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAub2JqZWN0QWNjc2Vzc29yXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY3Nlc3NvciA9IHByZWZpeFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gYCR7cHJlZml4fSR7cHJlfSR7YWNjc2Vzc29yfSR7cG9zdH1gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBhY2NzZXNzb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKEd1YXJkc18xLkd1YXJkcy5pc1R5cGVvZk9iamVjdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKE9iamVjdCh2YWx1ZSkudG9RdWVyaWVzKG9wdGlvbnMsIGFjY3Nlc3NvcikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYCR7YWNjc2Vzc29yfT0ke2VuY29kZVVSSUNvbXBvbmVudChgJHt2YWx1ZX1gKX1gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcihydWxlc18xLm5vbkVtcHR5U3RyaW5nKTtcbiAgICAgICAgICAgIHJlc3VsdCA9IFtdLmNvbmNhdC5hcHBseShbXSwgcmVzdWx0KTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQubGVuZ3RoID8gcmVzdWx0LmpvaW4oJyYnKSA6ICcnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXQsXG4gICAgICAgICAgICB0b1F1ZXJpZXMsXG4gICAgICAgIH07XG4gICAgfVxuICAgIEJhc2UuT2JqZWN0ID0gT2JqZWN0O1xuICAgIGZ1bmN0aW9uIFN0cmluZyhzdHJpbmcpIHtcbiAgICAgICAgZnVuY3Rpb24gaGFzUXVlcnlQYXJhbXMoKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7c3RyaW5nfWAuaW5kZXhPZignPycpICE9PSAtMTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBqb2luUXVlcnlTdHJpbmcocXVlcnlTdHJpbmcpIHtcbiAgICAgICAgICAgIGNvbnN0IGlzSGFzUXVlcnlQYXJhbXMgPSBoYXNRdWVyeVBhcmFtcygpO1xuICAgICAgICAgICAgcmV0dXJuIGlzSGFzUXVlcnlQYXJhbXNcbiAgICAgICAgICAgICAgICA/IGAke3N0cmluZ30mJHtxdWVyeVN0cmluZ31gXG4gICAgICAgICAgICAgICAgOiBgJHtzdHJpbmd9PyR7cXVlcnlTdHJpbmd9YDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzcGxpdChzZXBhcmF0b3IsIGxpbWl0KSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7c3RyaW5nfWAuc3BsaXQoc2VwYXJhdG9yLCBsaW1pdCk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVwbGFjZUFsbFNlcGFyYXRlZFN0cmluZyhzZXBhcmF0b3IsIHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgY29uc3QgcGFydHMgPSBzcGxpdChzZXBhcmF0b3IpO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5ID0gQmFzZS5PYmplY3QocHJvcGVydGllcykuZ2V0KHBhcnRzW2ldKTtcbiAgICAgICAgICAgICAgICBpZiAoQmFzZS5PYmplY3QocHJvcGVydGllcykuZ2V0KHBhcnRzW2ldKSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChwcm9wZXJ0eSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChwYXJ0c1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKHNlcGFyYXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNwbGl0LFxuICAgICAgICAgICAgcmVwbGFjZUFsbFNlcGFyYXRlZFN0cmluZyxcbiAgICAgICAgICAgIGhhc1F1ZXJ5UGFyYW1zLFxuICAgICAgICAgICAgam9pblF1ZXJ5U3RyaW5nLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBCYXNlLlN0cmluZyA9IFN0cmluZztcbn0pKEJhc2UgfHwgKEJhc2UgPSB7fSkpO1xuZXhwb3J0cy5CYXNlID0gQmFzZTtcbiIsImltcG9ydCB7IEd1YXJkcyB9IGZyb20gJy4uL0d1YXJkcydcbmltcG9ydCB7IG5vbkVtcHR5U3RyaW5nIH0gZnJvbSAnLi9ydWxlcydcbmltcG9ydCB7IFR5cGVzIH0gZnJvbSAnLi9UeXBlcydcblxubmFtZXNwYWNlIEJhc2Uge1xuICAgIGV4cG9ydCBmdW5jdGlvbiBPYmplY3Q8TyBleHRlbmRzIG9iamVjdD4ob2JqOiBPKSB7XG4gICAgICAgIGZ1bmN0aW9uIGdldDxLIGV4dGVuZHMgc3RyaW5nPihrZXk6IEsgfCBrZXlvZiBPKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JqW2tleSBhcyBFeGNsdWRlPHR5cGVvZiBrZXksIEs+XVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdG9RdWVyaWVzKFxuICAgICAgICAgICAgb3B0aW9uczogUGFydGlhbDxUeXBlcy5PYmplY3QuVG9RdWVyaWVzT3B0aW9ucz4gPSBUeXBlcy5PYmplY3RcbiAgICAgICAgICAgICAgICAuZGVmYXVsdFRvUXVlcmllc09wdGlvbnMsXG4gICAgICAgICAgICBwcmVmaXg/OiBzdHJpbmdcbiAgICAgICAgKTogc3RyaW5nIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc2tpcE51bGwsIHNraXBVbmRlZmluZWQgfSA9IG9wdGlvbnNcblxuICAgICAgICAgICAgbGV0IHJlc3VsdDogc3RyaW5nW10gPSBbXVxuXG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZ2V0KGtleSlcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2tpcE51bGwgPT09IHRydWUgJiYgR3VhcmRzLmlzTnVsbCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICBza2lwVW5kZWZpbmVkID09PSB0cnVlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBHdWFyZHMuaXNVbmRlZmluZWQodmFsdWUpXG4gICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGxldCBhY2NzZXNzb3I6IHN0cmluZyA9IGtleVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChHdWFyZHMuaXNBcnJheUNvbnN0cnVjdG9yKG9iaikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFtwcmUsIHBvc3RdID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUeXBlcy5PYmplY3QudG9RdWVyaWVzQWNjc2Vzc29yc1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hcnJheUFjY3Nlc3NvciB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZXMuT2JqZWN0LmRlZmF1bHRUb1F1ZXJpZXNPcHRpb25zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFycmF5QWNjc2Vzc29yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjc2Vzc29yID0gYCR7cHJlZml4fSR7cHJlfSR7cG9zdH1gXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoR3VhcmRzLmlzT2JqZWN0Q29uc3RydWN0b3Iob2JqKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgW3ByZSwgcG9zdF0gPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFR5cGVzLk9iamVjdC50b1F1ZXJpZXNBY2NzZXNzb3JzW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm9iamVjdEFjY3Nlc3NvciB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZXMuT2JqZWN0LmRlZmF1bHRUb1F1ZXJpZXNPcHRpb25zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9iamVjdEFjY3Nlc3NvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY3Nlc3NvciA9IHByZWZpeFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gYCR7cHJlZml4fSR7cHJlfSR7YWNjc2Vzc29yfSR7cG9zdH1gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBhY2NzZXNzb3JcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChHdWFyZHMuaXNUeXBlb2ZPYmplY3QodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChPYmplY3QodmFsdWUpLnRvUXVlcmllcyhvcHRpb25zLCBhY2NzZXNzb3IpKVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7YWNjc2Vzc29yfT0ke2VuY29kZVVSSUNvbXBvbmVudChgJHt2YWx1ZX1gKX1gXG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcihub25FbXB0eVN0cmluZylcblxuICAgICAgICAgICAgcmVzdWx0ID0gKFtdIGFzIHN0cmluZ1tdKS5jb25jYXQuYXBwbHkoW10gYXMgc3RyaW5nW10sIHJlc3VsdClcblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPyByZXN1bHQuam9pbignJicpIDogJydcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXQsXG4gICAgICAgICAgICB0b1F1ZXJpZXMsXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gU3RyaW5nPFMgZXh0ZW5kcyBzdHJpbmc+KHN0cmluZzogUykge1xuICAgICAgICBmdW5jdGlvbiBoYXNRdWVyeVBhcmFtcygpIHtcbiAgICAgICAgICAgIHJldHVybiBgJHtzdHJpbmd9YC5pbmRleE9mKCc/JykgIT09IC0xXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBqb2luUXVlcnlTdHJpbmc8USBleHRlbmRzIHN0cmluZz4oXG4gICAgICAgICAgICBxdWVyeVN0cmluZzogUVxuICAgICAgICApOiBTIGV4dGVuZHMgYCR7c3RyaW5nfT8ke3N0cmluZ31gID8gYCR7U30mJHtRfWAgOiBgJHtTfT8ke1F9YCB7XG4gICAgICAgICAgICBjb25zdCBpc0hhc1F1ZXJ5UGFyYW1zID0gaGFzUXVlcnlQYXJhbXMoKVxuICAgICAgICAgICAgcmV0dXJuIGlzSGFzUXVlcnlQYXJhbXNcbiAgICAgICAgICAgICAgICA/IGAke3N0cmluZ30mJHtxdWVyeVN0cmluZ31gXG4gICAgICAgICAgICAgICAgOiAoYCR7c3RyaW5nfT8ke3F1ZXJ5U3RyaW5nfWAgYXMgYW55KVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3BsaXQ8U2VwYXJhdG9yIGV4dGVuZHMgc3RyaW5nPihcbiAgICAgICAgICAgIHNlcGFyYXRvcjogc3RyaW5nLFxuICAgICAgICAgICAgbGltaXQ/OiBudW1iZXIgfCB1bmRlZmluZWRcbiAgICAgICAgKTogVHlwZXMuU3RyaW5nLlNwbGl0PFMsIFNlcGFyYXRvcj4ge1xuICAgICAgICAgICAgcmV0dXJuIGAke3N0cmluZ31gLnNwbGl0KHNlcGFyYXRvciwgbGltaXQpIGFzIGFueVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVwbGFjZUFsbFNlcGFyYXRlZFN0cmluZzxcbiAgICAgICAgICAgIFAgZXh0ZW5kcyB7IFt4OiBzdHJpbmddOiBhbnkgfSxcbiAgICAgICAgICAgIFNlcGFyYXRvciBleHRlbmRzIHN0cmluZyA9IHN0cmluZ1xuICAgICAgICA+KHNlcGFyYXRvcjogU2VwYXJhdG9yLCBwcm9wZXJ0aWVzOiBQKTogVHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UywgUD4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW11cblxuICAgICAgICAgICAgY29uc3QgcGFydHMgPSBzcGxpdChzZXBhcmF0b3IpXG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IEJhc2UuT2JqZWN0PFA+KHByb3BlcnRpZXMpLmdldChwYXJ0c1tpXSlcblxuICAgICAgICAgICAgICAgIGlmIChCYXNlLk9iamVjdDxQPihwcm9wZXJ0aWVzKS5nZXQocGFydHNbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHByb3BlcnR5KVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHBhcnRzW2ldKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKHNlcGFyYXRvcikgYXMgVHlwZXMuU3RyaW5nLlJlcGxhY2VBbGw8UywgUD5cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzcGxpdCxcbiAgICAgICAgICAgIHJlcGxhY2VBbGxTZXBhcmF0ZWRTdHJpbmcsXG4gICAgICAgICAgICBoYXNRdWVyeVBhcmFtcyxcbiAgICAgICAgICAgIGpvaW5RdWVyeVN0cmluZyxcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgQmFzZSB9XG4iXX0=
