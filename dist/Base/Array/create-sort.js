"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Types_1=require("../Types"),Guards_1=require("../../Guards"),Object_1=require("../Object"),createSort=c=>r=>{let d=!1;const{field:e,order:s,orders:a,onUpdate:t}=r,u={_collection:[],_order:Types_1.Types.Array.Sort.defaultOrder,_orders:Types_1.Types.Array.Sort.defaultOrders,_field:void 0},i=()=>{Guards_1.Guards.isFunc(t)&&t(u)};r=()=>{u._field=e||void 0,u._order=s||Types_1.Types.Array.Sort.defaultOrder,u._orders=a||Types_1.Types.Array.Sort.defaultOrders,u._collection=[].concat.apply(c),i()};const o=r=>{Guards_1.Guards.isUndefined(r)||(u._field=r)},l=(r,e)=>{let s=!1;e?Guards_1.Guards.isString(u._field)&&Guards_1.Guards.isString(r)?u._field===r&&(s=d):Guards_1.Guards.isString(u._field)&&Guards_1.Guards.isObject(r)?u._field===r.xpath&&(s=d):Guards_1.Guards.isObject(u._field)&&Guards_1.Guards.isString(r)?u._field.xpath===r&&(s=d):Guards_1.Guards.isObject(u._field)&&Guards_1.Guards.isObject(r)&&u._field.xpath===r.xpath&&(s=d):s=d,s&&(e=u._orders.length-1,r=u._orders.indexOf(u._order)+1,u._order=r<=e?u._orders[r]:u._orders[0])},G=()=>"default"===u._order&&(u._collection=[].concat.apply(c),i(),!0);var _=(r={})=>{var{field:r,noUpdateOrderFalsyEqualXPath:e=!1}=r;if(l(r,e),o(r),!G()){const a="ASC"===u._order,t=Guards_1.Guards.isString(u._field),_=Guards_1.Guards.isObject(u._field);u._collection=u._collection.sort((r,e)=>{let s=0;t?(r=r[u._field],e=e[u._field]):_&&(r=u._field.handler((0,Object_1.$Object)(r).getXPath(u._field.xpath)),e=u._field.handler((0,Object_1.$Object)(e).getXPath(u._field.xpath)));var d=Types_1.Types.Array.Sort.compareStrings(a,Guards_1.Guards.isString(r),Guards_1.Guards.isString(e),r,e),d=(Guards_1.Guards.isNumber(d)&&(s=d),Types_1.Types.Array.Sort.compareNumbers(a,Guards_1.Guards.isNumber(r),Guards_1.Guards.isNumber(e),r,e)),d=(Guards_1.Guards.isNumber(d)&&(s=d),Types_1.Types.Array.Sort.compareBooleans(a,Guards_1.Guards.isBoolean(r),Guards_1.Guards.isBoolean(e),r,e));return s=Guards_1.Guards.isNumber(d)?d:s}),i()}};return r(),d||(_({field:e}),d=!0),{cleanup:r,update:_}};exports.default=createSort;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJhc2UvQXJyYXkvY3JlYXRlLXNvcnQuanMiLCIuLi9zcmMvQmFzZS9BcnJheS9jcmVhdGUtc29ydC50cyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIlR5cGVzXzEiLCJyZXF1aXJlIiwiR3VhcmRzXzEiLCJPYmplY3RfMSIsImNyZWF0ZVNvcnQiLCJjb2xsZWN0aW9uIiwib3B0aW9ucyIsImxldCIsImNhbGxlZCIsImZpZWxkIiwib3JkZXIiLCJvcmRlcnMiLCJvblVwZGF0ZSIsInN0YXRlIiwiX2NvbGxlY3Rpb24iLCJfb3JkZXIiLCJUeXBlcyIsIkFycmF5IiwiU29ydCIsImRlZmF1bHRPcmRlciIsIl9vcmRlcnMiLCJkZWZhdWx0T3JkZXJzIiwiX2ZpZWxkIiwidW5kZWZpbmVkIiwib25VcGRhdGVDYWxsYmFjayIsIkd1YXJkcyIsImlzRnVuYyIsImluc3RhbGwiLCJjb25jYXQiLCJhcHBseSIsInVwZGF0ZUZpZWxkIiwiaXNVbmRlZmluZWQiLCJ1cGRhdGVPcmRlciIsIm5vVXBkYXRlT3JkZXJGYWxzeUVxdWFsWFBhdGgiLCJpcyIsImlzU3RyaW5nIiwiaXNPYmplY3QiLCJ4cGF0aCIsImxhc3RPcmRlckluZGV4IiwibGVuZ3RoIiwibmV4dE9yZGVySW5kZXgiLCJpbmRleE9mIiwib25EZWZhdWx0T3JkZXIiLCJ1cGRhdGUiLCJpc0FzYyIsImlzU3RyaW5nRmllbGQiLCJpc09iamVjdEZpZWxkIiwic29ydCIsImwiLCJyIiwibiIsImhhbmRsZXIiLCIkT2JqZWN0IiwiZ2V0WFBhdGgiLCJzdHJpbmdzQ29tcGFyYXRpb24iLCJjb21wYXJlU3RyaW5ncyIsIm51bWJlcnNDb21wYXJhdGlvbiIsImlzTnVtYmVyIiwiY29tcGFyZU51bWJlcnMiLCJib29sZWFuQ29tcGFyYXRpb24iLCJjb21wYXJlQm9vbGVhbnMiLCJpc0Jvb2xlYW4iLCJjbGVhbnVwIiwiZGVmYXVsdCJdLCJtYXBwaW5ncyI6IkFBQUEsYUFDQUEsT0FBT0MsZUFBZUMsUUFBUyxhQUFjLENBQUVDLE1BQU8sQ0FBQSxDQUFLLENBQUMsRUNENUQsTUFBQUMsUUFBQUMsUUFBQSxVQUFBLEVBQ0FDLFNBQUFELFFBQUEsY0FBQSxFQUNBRSxTQUFBRixRQUFBLFdBQUEsRUFFTUcsV0FDZ0JDLEdBRWRDLElBRUFDLElBQUlDLEVBQWtCLENBQUEsRUFFdEIsS0FBTSxDQUFFQyxNQUFBQSxFQUFPQyxNQUFBQSxFQUFPQyxPQUFBQSxFQUFRQyxTQUFBQSxDQUFRLEVBQUtOLEVBRXJDTyxFQUFtQyxDQUNyQ0MsWUFBYSxHQUNiQyxPQUFRZixRQUFBZ0IsTUFBTUMsTUFBTUMsS0FBS0MsYUFDekJDLFFBQVNwQixRQUFBZ0IsTUFBTUMsTUFBTUMsS0FBS0csY0FDMUJDLE9BQVFDLEtBQUFBLENBTlVaLEVBU2hCYSxFQUFtQkEsS0FDakJ0QixTQUFBdUIsT0FBT0MsT0FBT2QsQ0FBUSxHQUN0QkEsRUFBU0MsQ0FBSyxDQUV0QixFQUVNYyxFQUFVQSxLQUNaZCxFQUFNUyxPQUFTYixHQUFnQmMsS0FBQUEsRUFDL0JWLEVBQU1FLE9BQVNMLEdBQWdCVixRQUFBZ0IsTUFBTUMsTUFBTUMsS0FBS0MsYUFDaEROLEVBQU1PLFFBQVVULEdBQWtCWCxRQUFBZ0IsTUFBTUMsTUFBTUMsS0FBS0csY0FDbkRSLEVBQU1DLFlBQWUsR0FBb0JjLE9BQU9DLE1BQzVDeEIsQ0FBVSxFQUVkbUIsRUFBZ0IsQ0FDcEIsRUFFQSxNQUFNTSxFQUdGckIsSUFFS1AsU0FBQXVCLE9BQU9NLFlBQVl0QixDQUFLLElBQ3pCSSxFQUFNUyxPQUFTYixFQUV2QixFQUVNdUIsRUFBY0EsQ0FHaEJ2QixFQUNBd0IsS0FFQTFCLElBQUkyQixFQUFjLENBQUEsRUFFZEQsRUFDSS9CLFNBQUF1QixPQUFPVSxTQUFTdEIsRUFBTVMsTUFBTSxHQUFLcEIsU0FBQXVCLE9BQU9VLFNBQVMxQixDQUFLLEVBQ2xESSxFQUFNUyxTQUFXYixJQUNqQnlCLEVBQWExQixHQUdqQk4sU0FBQXVCLE9BQU9VLFNBQVN0QixFQUFNUyxNQUFNLEdBQzVCcEIsU0FBQXVCLE9BQU9XLFNBQVMzQixDQUFLLEVBRWpCSSxFQUFNUyxTQUFXYixFQUFNNEIsUUFDdkJILEVBQWExQixHQUdqQk4sU0FBQXVCLE9BQU9XLFNBQVN2QixFQUFNUyxNQUFNLEdBQzVCcEIsU0FBQXVCLE9BQU9VLFNBQVMxQixDQUFLLEVBRWpCSSxFQUFNUyxPQUFPZSxRQUFVNUIsSUFDdkJ5QixFQUFhMUIsR0FHakJOLFNBQUF1QixPQUFPVyxTQUFTdkIsRUFBTVMsTUFBTSxHQUM1QnBCLFNBQUF1QixPQUFPVyxTQUFTM0IsQ0FBSyxHQUVqQkksRUFBTVMsT0FBT2UsUUFBVTVCLEVBQU00QixRQUM3QkgsRUFBYTFCLEdBSXJCMEIsRUFBYTFCLEVBR2IwQixJQUNNSSxFQUFpQnpCLEVBQU1PLFFBQVFtQixPQUFTLEVBRXhDQyxFQURvQjNCLEVBQU1PLFFBQVFxQixRQUFRNUIsRUFBTUUsTUFBTSxFQUNqQixFQUMzQ0YsRUFBTUUsT0FDRnlCLEdBQWtCRixFQUNaekIsRUFBTU8sUUFBUW9CLEdBQ2QzQixFQUFNTyxRQUFRLEdBRWhDLEVBRU1zQixFQUFpQkEsSUFDRSxZQUFqQjdCLEVBQU1FLFNBQ05GLEVBQU1DLFlBQWUsR0FBb0JjLE9BQU9DLE1BQzVDeEIsQ0FBVSxFQUdkbUIsRUFBZ0IsRUFFVCxDQUFBLEdBS2YsSUFBTW1CLEVBQVNBLENBR1hyQyxFQUFvRCxNQUVwRCxHQUFNLENBQUVHLE1BQUFBLEVBQU93Qiw2QkFBQUEsRUFBK0IsQ0FBQSxDQUFLLEVBQUszQixFQU14RCxHQUpBMEIsRUFBWXZCLEVBQU93QixDQUE0QixFQUUvQ0gsRUFBWXJCLENBQUssRUFFYixDQUFDaUMsRUFBYyxFQUFJLENBQ25CLE1BQU1FLEVBQXlCLFFBQWpCL0IsRUFBTUUsT0FDZDhCLEVBQWdCM0MsU0FBQXVCLE9BQU9VLFNBQVN0QixFQUFNUyxNQUFNLEVBQzVDd0IsRUFBZ0I1QyxTQUFBdUIsT0FBT1csU0FBU3ZCLEVBQU1TLE1BQU0sRUFFbERULEVBQU1DLFlBQWNELEVBQU1DLFlBQVlpQyxLQUFLLENBQUNDLEVBQUdDLEtBQzNDMUMsSUFBSTJDLEVBQUksRUFFSkwsR0FDQUcsRUFBSUEsRUFBRW5DLEVBQU1TLFFBQ1oyQixFQUFJQSxFQUFFcEMsRUFBTVMsU0FDTHdCLElBQ1BFLEVBQ0luQyxFQUFNUyxPQUlSNkIsU0FDRSxFQUFBaEQsU0FBQWlELFNBQVFKLENBQUMsRUFBRUssU0FFSHhDLEVBQU1TLE9BSVJlLEtBQUssQ0FDVixFQUVMWSxFQUNJcEMsRUFBTVMsT0FJUjZCLFNBQ0UsRUFBQWhELFNBQUFpRCxTQUFRSCxDQUFDLEVBQUVJLFNBRUh4QyxFQUFNUyxPQUlSZSxLQUFLLENBQ1YsR0FJVCxJQUFNaUIsRUFBcUJ0RCxRQUFBZ0IsTUFBTUMsTUFBTUMsS0FBS3FDLGVBQ3hDWCxFQUNBMUMsU0FBQXVCLE9BQU9VLFNBQVNhLENBQUMsRUFDakI5QyxTQUFBdUIsT0FBT1UsU0FBU2MsQ0FBQyxFQUNqQkQsRUFDQUMsQ0FBQyxFQU9DTyxHQUpGdEQsU0FBQXVCLE9BQU9nQyxTQUFTSCxDQUFrQixJQUNsQ0osRUFBSUksR0FHbUJ0RCxRQUFBZ0IsTUFBTUMsTUFBTUMsS0FBS3dDLGVBQ3hDZCxFQUNBMUMsU0FBQXVCLE9BQU9nQyxTQUFTVCxDQUFDLEVBQ2pCOUMsU0FBQXVCLE9BQU9nQyxTQUFTUixDQUFDLEVBQ2pCRCxFQUNBQyxDQUFDLEdBT0NVLEdBSkZ6RCxTQUFBdUIsT0FBT2dDLFNBQVNELENBQWtCLElBQ2xDTixFQUFJTSxHQUdtQnhELFFBQUFnQixNQUFNQyxNQUFNQyxLQUFLMEMsZ0JBQ3hDaEIsRUFDQTFDLFNBQUF1QixPQUFPb0MsVUFBVWIsQ0FBQyxFQUNsQjlDLFNBQUF1QixPQUFPb0MsVUFBVVosQ0FBQyxFQUNsQkQsRUFDQUMsQ0FBQyxHQU9MLE9BSElDLEVBREFoRCxTQUFBdUIsT0FBT2dDLFNBQVNFLENBQWtCLEVBQzlCQSxFQUdEVCxDQUNYLENBQUMsRUFFRDFCLEVBQWdCLENEM0Z4QixDQzZGQSxFQVdBLE9BVEFHLEVBQU8sRUFFRm5CLElBQ0RtQyxFQUFPLENBQ0hsQyxNQUFBQSxDQUNGLENBQUQsRUFDREQsRUFBUyxDQUFBLEdBR04sQ0FDSHNELFFBQVNuQyxFQUNUZ0IsT0FBQUEsQ0FDSCxDQUNMLEVBRUo3QyxRQUFBaUUsUUFBZTNEIiwiZmlsZSI6IkJhc2UvQXJyYXkvY3JlYXRlLXNvcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IFR5cGVzXzEgPSByZXF1aXJlKFwiLi4vVHlwZXNcIik7XG5jb25zdCBHdWFyZHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9HdWFyZHNcIik7XG5jb25zdCBPYmplY3RfMSA9IHJlcXVpcmUoXCIuLi9PYmplY3RcIik7XG5jb25zdCBjcmVhdGVTb3J0ID0gKGNvbGxlY3Rpb24pID0+IChvcHRpb25zKSA9PiB7XG4gICAgbGV0IGNhbGxlZCA9IGZhbHNlO1xuICAgIGNvbnN0IHsgZmllbGQsIG9yZGVyLCBvcmRlcnMsIG9uVXBkYXRlIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IHN0YXRlID0ge1xuICAgICAgICBfY29sbGVjdGlvbjogW10sXG4gICAgICAgIF9vcmRlcjogVHlwZXNfMS5UeXBlcy5BcnJheS5Tb3J0LmRlZmF1bHRPcmRlcixcbiAgICAgICAgX29yZGVyczogVHlwZXNfMS5UeXBlcy5BcnJheS5Tb3J0LmRlZmF1bHRPcmRlcnMsXG4gICAgICAgIF9maWVsZDogdW5kZWZpbmVkLFxuICAgIH07XG4gICAgY29uc3Qgb25VcGRhdGVDYWxsYmFjayA9ICgpID0+IHtcbiAgICAgICAgaWYgKEd1YXJkc18xLkd1YXJkcy5pc0Z1bmMob25VcGRhdGUpKSB7XG4gICAgICAgICAgICBvblVwZGF0ZShzdGF0ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGluc3RhbGwgPSAoKSA9PiB7XG4gICAgICAgIHN0YXRlLl9maWVsZCA9IGZpZWxkID8gZmllbGQgOiB1bmRlZmluZWQ7XG4gICAgICAgIHN0YXRlLl9vcmRlciA9IG9yZGVyID8gb3JkZXIgOiBUeXBlc18xLlR5cGVzLkFycmF5LlNvcnQuZGVmYXVsdE9yZGVyO1xuICAgICAgICBzdGF0ZS5fb3JkZXJzID0gb3JkZXJzID8gb3JkZXJzIDogVHlwZXNfMS5UeXBlcy5BcnJheS5Tb3J0LmRlZmF1bHRPcmRlcnM7XG4gICAgICAgIHN0YXRlLl9jb2xsZWN0aW9uID0gW10uY29uY2F0LmFwcGx5KGNvbGxlY3Rpb24pO1xuICAgICAgICBvblVwZGF0ZUNhbGxiYWNrKCk7XG4gICAgfTtcbiAgICBjb25zdCB1cGRhdGVGaWVsZCA9IChmaWVsZCkgPT4ge1xuICAgICAgICBpZiAoIUd1YXJkc18xLkd1YXJkcy5pc1VuZGVmaW5lZChmaWVsZCkpIHtcbiAgICAgICAgICAgIHN0YXRlLl9maWVsZCA9IGZpZWxkO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCB1cGRhdGVPcmRlciA9IChmaWVsZCwgbm9VcGRhdGVPcmRlckZhbHN5RXF1YWxYUGF0aCkgPT4ge1xuICAgICAgICBsZXQgaXMgPSBmYWxzZTtcbiAgICAgICAgaWYgKG5vVXBkYXRlT3JkZXJGYWxzeUVxdWFsWFBhdGgpIHtcbiAgICAgICAgICAgIGlmIChHdWFyZHNfMS5HdWFyZHMuaXNTdHJpbmcoc3RhdGUuX2ZpZWxkKSAmJiBHdWFyZHNfMS5HdWFyZHMuaXNTdHJpbmcoZmllbGQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlLl9maWVsZCA9PT0gZmllbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaXMgPSB0cnVlICYmIGNhbGxlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChHdWFyZHNfMS5HdWFyZHMuaXNTdHJpbmcoc3RhdGUuX2ZpZWxkKSAmJlxuICAgICAgICAgICAgICAgIEd1YXJkc18xLkd1YXJkcy5pc09iamVjdChmaWVsZCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuX2ZpZWxkID09PSBmaWVsZC54cGF0aCkge1xuICAgICAgICAgICAgICAgICAgICBpcyA9IHRydWUgJiYgY2FsbGVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKEd1YXJkc18xLkd1YXJkcy5pc09iamVjdChzdGF0ZS5fZmllbGQpICYmXG4gICAgICAgICAgICAgICAgR3VhcmRzXzEuR3VhcmRzLmlzU3RyaW5nKGZpZWxkKSkge1xuICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5fZmllbGQueHBhdGggPT09IGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzID0gdHJ1ZSAmJiBjYWxsZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoR3VhcmRzXzEuR3VhcmRzLmlzT2JqZWN0KHN0YXRlLl9maWVsZCkgJiZcbiAgICAgICAgICAgICAgICBHdWFyZHNfMS5HdWFyZHMuaXNPYmplY3QoZmllbGQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlLl9maWVsZC54cGF0aCA9PT0gZmllbGQueHBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaXMgPSB0cnVlICYmIGNhbGxlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpcyA9IHRydWUgJiYgY2FsbGVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpcykge1xuICAgICAgICAgICAgY29uc3QgbGFzdE9yZGVySW5kZXggPSBzdGF0ZS5fb3JkZXJzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50T3JkZXJJbmRleCA9IHN0YXRlLl9vcmRlcnMuaW5kZXhPZihzdGF0ZS5fb3JkZXIpO1xuICAgICAgICAgICAgY29uc3QgbmV4dE9yZGVySW5kZXggPSBjdXJyZW50T3JkZXJJbmRleCArIDE7XG4gICAgICAgICAgICBzdGF0ZS5fb3JkZXIgPVxuICAgICAgICAgICAgICAgIG5leHRPcmRlckluZGV4IDw9IGxhc3RPcmRlckluZGV4XG4gICAgICAgICAgICAgICAgICAgID8gc3RhdGUuX29yZGVyc1tuZXh0T3JkZXJJbmRleF1cbiAgICAgICAgICAgICAgICAgICAgOiBzdGF0ZS5fb3JkZXJzWzBdO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBvbkRlZmF1bHRPcmRlciA9ICgpID0+IHtcbiAgICAgICAgaWYgKHN0YXRlLl9vcmRlciA9PT0gJ2RlZmF1bHQnKSB7XG4gICAgICAgICAgICBzdGF0ZS5fY29sbGVjdGlvbiA9IFtdLmNvbmNhdC5hcHBseShjb2xsZWN0aW9uKTtcbiAgICAgICAgICAgIG9uVXBkYXRlQ2FsbGJhY2soKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIGNvbnN0IHVwZGF0ZSA9IChvcHRpb25zID0ge30pID0+IHtcbiAgICAgICAgY29uc3QgeyBmaWVsZCwgbm9VcGRhdGVPcmRlckZhbHN5RXF1YWxYUGF0aCA9IGZhbHNlIH0gPSBvcHRpb25zO1xuICAgICAgICB1cGRhdGVPcmRlcihmaWVsZCwgbm9VcGRhdGVPcmRlckZhbHN5RXF1YWxYUGF0aCk7XG4gICAgICAgIHVwZGF0ZUZpZWxkKGZpZWxkKTtcbiAgICAgICAgaWYgKCFvbkRlZmF1bHRPcmRlcigpKSB7XG4gICAgICAgICAgICBjb25zdCBpc0FzYyA9IHN0YXRlLl9vcmRlciA9PT0gJ0FTQyc7XG4gICAgICAgICAgICBjb25zdCBpc1N0cmluZ0ZpZWxkID0gR3VhcmRzXzEuR3VhcmRzLmlzU3RyaW5nKHN0YXRlLl9maWVsZCk7XG4gICAgICAgICAgICBjb25zdCBpc09iamVjdEZpZWxkID0gR3VhcmRzXzEuR3VhcmRzLmlzT2JqZWN0KHN0YXRlLl9maWVsZCk7XG4gICAgICAgICAgICBzdGF0ZS5fY29sbGVjdGlvbiA9IHN0YXRlLl9jb2xsZWN0aW9uLnNvcnQoKGwsIHIpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgbiA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKGlzU3RyaW5nRmllbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgbCA9IGxbc3RhdGUuX2ZpZWxkXTtcbiAgICAgICAgICAgICAgICAgICAgciA9IHJbc3RhdGUuX2ZpZWxkXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNPYmplY3RGaWVsZCkge1xuICAgICAgICAgICAgICAgICAgICBsID0gc3RhdGUuX2ZpZWxkLmhhbmRsZXIoKDAsIE9iamVjdF8xLiRPYmplY3QpKGwpLmdldFhQYXRoKHN0YXRlLl9maWVsZC54cGF0aCkpO1xuICAgICAgICAgICAgICAgICAgICByID0gc3RhdGUuX2ZpZWxkLmhhbmRsZXIoKDAsIE9iamVjdF8xLiRPYmplY3QpKHIpLmdldFhQYXRoKHN0YXRlLl9maWVsZC54cGF0aCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmdzQ29tcGFyYXRpb24gPSBUeXBlc18xLlR5cGVzLkFycmF5LlNvcnQuY29tcGFyZVN0cmluZ3MoaXNBc2MsIEd1YXJkc18xLkd1YXJkcy5pc1N0cmluZyhsKSwgR3VhcmRzXzEuR3VhcmRzLmlzU3RyaW5nKHIpLCBsLCByKTtcbiAgICAgICAgICAgICAgICBpZiAoR3VhcmRzXzEuR3VhcmRzLmlzTnVtYmVyKHN0cmluZ3NDb21wYXJhdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgbiA9IHN0cmluZ3NDb21wYXJhdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtYmVyc0NvbXBhcmF0aW9uID0gVHlwZXNfMS5UeXBlcy5BcnJheS5Tb3J0LmNvbXBhcmVOdW1iZXJzKGlzQXNjLCBHdWFyZHNfMS5HdWFyZHMuaXNOdW1iZXIobCksIEd1YXJkc18xLkd1YXJkcy5pc051bWJlcihyKSwgbCwgcik7XG4gICAgICAgICAgICAgICAgaWYgKEd1YXJkc18xLkd1YXJkcy5pc051bWJlcihudW1iZXJzQ29tcGFyYXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIG4gPSBudW1iZXJzQ29tcGFyYXRpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGJvb2xlYW5Db21wYXJhdGlvbiA9IFR5cGVzXzEuVHlwZXMuQXJyYXkuU29ydC5jb21wYXJlQm9vbGVhbnMoaXNBc2MsIEd1YXJkc18xLkd1YXJkcy5pc0Jvb2xlYW4obCksIEd1YXJkc18xLkd1YXJkcy5pc0Jvb2xlYW4ociksIGwsIHIpO1xuICAgICAgICAgICAgICAgIGlmIChHdWFyZHNfMS5HdWFyZHMuaXNOdW1iZXIoYm9vbGVhbkNvbXBhcmF0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICBuID0gYm9vbGVhbkNvbXBhcmF0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgb25VcGRhdGVDYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBpbnN0YWxsKCk7XG4gICAgaWYgKCFjYWxsZWQpIHtcbiAgICAgICAgdXBkYXRlKHtcbiAgICAgICAgICAgIGZpZWxkLFxuICAgICAgICB9KTtcbiAgICAgICAgY2FsbGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY2xlYW51cDogaW5zdGFsbCxcbiAgICAgICAgdXBkYXRlLFxuICAgIH07XG59O1xuZXhwb3J0cy5kZWZhdWx0ID0gY3JlYXRlU29ydDtcbiIsImltcG9ydCB7IFR5cGVzIH0gZnJvbSAnLi4vVHlwZXMnXG5pbXBvcnQgeyBHdWFyZHMgfSBmcm9tICcuLi8uLi9HdWFyZHMnXG5pbXBvcnQgeyAkT2JqZWN0IH0gZnJvbSAnLi4vT2JqZWN0J1xuXG5jb25zdCBjcmVhdGVTb3J0ID1cbiAgICA8VCBleHRlbmRzIGFueVtdPihjb2xsZWN0aW9uOiBUKSA9PlxuICAgIDxYUGF0aCBleHRlbmRzIFR5cGVzLlV0aWxpdHkuSlNPTlBhdGg8VHlwZXMuQXJyYXkuT2Y8VD4+PihcbiAgICAgICAgb3B0aW9uczogVHlwZXMuQXJyYXkuU29ydC5PcHRpb25zPFQsIFhQYXRoPlxuICAgICkgPT4ge1xuICAgICAgICBsZXQgY2FsbGVkOiBib29sZWFuID0gZmFsc2VcblxuICAgICAgICBjb25zdCB7IGZpZWxkLCBvcmRlciwgb3JkZXJzLCBvblVwZGF0ZSB9ID0gb3B0aW9uc1xuXG4gICAgICAgIGNvbnN0IHN0YXRlOiBUeXBlcy5BcnJheS5Tb3J0LlN0YXRlPFQ+ID0ge1xuICAgICAgICAgICAgX2NvbGxlY3Rpb246IFtdIGFzIHVua25vd24gYXMgVCxcbiAgICAgICAgICAgIF9vcmRlcjogVHlwZXMuQXJyYXkuU29ydC5kZWZhdWx0T3JkZXIsXG4gICAgICAgICAgICBfb3JkZXJzOiBUeXBlcy5BcnJheS5Tb3J0LmRlZmF1bHRPcmRlcnMsXG4gICAgICAgICAgICBfZmllbGQ6IHVuZGVmaW5lZCxcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG9uVXBkYXRlQ2FsbGJhY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoR3VhcmRzLmlzRnVuYyhvblVwZGF0ZSkpIHtcbiAgICAgICAgICAgICAgICBvblVwZGF0ZShzdGF0ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGluc3RhbGwgPSAoKSA9PiB7XG4gICAgICAgICAgICBzdGF0ZS5fZmllbGQgPSBmaWVsZCA/IGZpZWxkIDogdW5kZWZpbmVkXG4gICAgICAgICAgICBzdGF0ZS5fb3JkZXIgPSBvcmRlciA/IG9yZGVyIDogVHlwZXMuQXJyYXkuU29ydC5kZWZhdWx0T3JkZXJcbiAgICAgICAgICAgIHN0YXRlLl9vcmRlcnMgPSBvcmRlcnMgPyBvcmRlcnMgOiBUeXBlcy5BcnJheS5Tb3J0LmRlZmF1bHRPcmRlcnNcbiAgICAgICAgICAgIHN0YXRlLl9jb2xsZWN0aW9uID0gKFtdIGFzIHVua25vd24gYXMgVCkuY29uY2F0LmFwcGx5KFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25cbiAgICAgICAgICAgICkgYXMgVFxuICAgICAgICAgICAgb25VcGRhdGVDYWxsYmFjaygpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1cGRhdGVGaWVsZCA9IDxcbiAgICAgICAgICAgIFhQYXRoIGV4dGVuZHMgVHlwZXMuVXRpbGl0eS5KU09OUGF0aDxUeXBlcy5BcnJheS5PZjxUPj5cbiAgICAgICAgPihcbiAgICAgICAgICAgIGZpZWxkOiBUeXBlcy5BcnJheS5Tb3J0LkZpZWxkPFQsIFhQYXRoPiB8IHVuZGVmaW5lZFxuICAgICAgICApID0+IHtcbiAgICAgICAgICAgIGlmICghR3VhcmRzLmlzVW5kZWZpbmVkKGZpZWxkKSkge1xuICAgICAgICAgICAgICAgIHN0YXRlLl9maWVsZCA9IGZpZWxkXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1cGRhdGVPcmRlciA9IDxcbiAgICAgICAgICAgIFhQYXRoIGV4dGVuZHMgVHlwZXMuVXRpbGl0eS5KU09OUGF0aDxUeXBlcy5BcnJheS5PZjxUPj5cbiAgICAgICAgPihcbiAgICAgICAgICAgIGZpZWxkOiBUeXBlcy5BcnJheS5Tb3J0LkZpZWxkPFQsIFhQYXRoPiB8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG5vVXBkYXRlT3JkZXJGYWxzeUVxdWFsWFBhdGg6IGJvb2xlYW5cbiAgICAgICAgKSA9PiB7XG4gICAgICAgICAgICBsZXQgaXM6IGJvb2xlYW4gPSBmYWxzZVxuXG4gICAgICAgICAgICBpZiAobm9VcGRhdGVPcmRlckZhbHN5RXF1YWxYUGF0aCkge1xuICAgICAgICAgICAgICAgIGlmIChHdWFyZHMuaXNTdHJpbmcoc3RhdGUuX2ZpZWxkKSAmJiBHdWFyZHMuaXNTdHJpbmcoZmllbGQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5fZmllbGQgPT09IGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpcyA9IHRydWUgJiYgY2FsbGVkXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICAgICAgICBHdWFyZHMuaXNTdHJpbmcoc3RhdGUuX2ZpZWxkKSAmJlxuICAgICAgICAgICAgICAgICAgICBHdWFyZHMuaXNPYmplY3QoZmllbGQpXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5fZmllbGQgPT09IGZpZWxkLnhwYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpcyA9IHRydWUgJiYgY2FsbGVkXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICAgICAgICBHdWFyZHMuaXNPYmplY3Qoc3RhdGUuX2ZpZWxkKSAmJlxuICAgICAgICAgICAgICAgICAgICBHdWFyZHMuaXNTdHJpbmcoZmllbGQpXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5fZmllbGQueHBhdGggPT09IGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpcyA9IHRydWUgJiYgY2FsbGVkXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICAgICAgICBHdWFyZHMuaXNPYmplY3Qoc3RhdGUuX2ZpZWxkKSAmJlxuICAgICAgICAgICAgICAgICAgICBHdWFyZHMuaXNPYmplY3QoZmllbGQpXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5fZmllbGQueHBhdGggPT09IGZpZWxkLnhwYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpcyA9IHRydWUgJiYgY2FsbGVkXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlzID0gdHJ1ZSAmJiBjYWxsZWRcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGlzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGFzdE9yZGVySW5kZXggPSBzdGF0ZS5fb3JkZXJzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50T3JkZXJJbmRleCA9IHN0YXRlLl9vcmRlcnMuaW5kZXhPZihzdGF0ZS5fb3JkZXIpXG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dE9yZGVySW5kZXggPSBjdXJyZW50T3JkZXJJbmRleCArIDFcbiAgICAgICAgICAgICAgICBzdGF0ZS5fb3JkZXIgPVxuICAgICAgICAgICAgICAgICAgICBuZXh0T3JkZXJJbmRleCA8PSBsYXN0T3JkZXJJbmRleFxuICAgICAgICAgICAgICAgICAgICAgICAgPyBzdGF0ZS5fb3JkZXJzW25leHRPcmRlckluZGV4XVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBzdGF0ZS5fb3JkZXJzWzBdXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBvbkRlZmF1bHRPcmRlciA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChzdGF0ZS5fb3JkZXIgPT09ICdkZWZhdWx0Jykge1xuICAgICAgICAgICAgICAgIHN0YXRlLl9jb2xsZWN0aW9uID0gKFtdIGFzIHVua25vd24gYXMgVCkuY29uY2F0LmFwcGx5KFxuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uXG4gICAgICAgICAgICAgICAgKSBhcyBUXG5cbiAgICAgICAgICAgICAgICBvblVwZGF0ZUNhbGxiYWNrKClcblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVwZGF0ZSA9IDxcbiAgICAgICAgICAgIFhQYXRoIGV4dGVuZHMgVHlwZXMuVXRpbGl0eS5KU09OUGF0aDxUeXBlcy5BcnJheS5PZjxUPj5cbiAgICAgICAgPihcbiAgICAgICAgICAgIG9wdGlvbnM6IFR5cGVzLkFycmF5LlNvcnQuVXBkYXRlT3B0aW9uczxULCBYUGF0aD4gPSB7fVxuICAgICAgICApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmllbGQsIG5vVXBkYXRlT3JkZXJGYWxzeUVxdWFsWFBhdGggPSBmYWxzZSB9ID0gb3B0aW9uc1xuXG4gICAgICAgICAgICB1cGRhdGVPcmRlcihmaWVsZCwgbm9VcGRhdGVPcmRlckZhbHN5RXF1YWxYUGF0aClcblxuICAgICAgICAgICAgdXBkYXRlRmllbGQoZmllbGQpXG5cbiAgICAgICAgICAgIGlmICghb25EZWZhdWx0T3JkZXIoKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzQXNjID0gc3RhdGUuX29yZGVyID09PSAnQVNDJ1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzU3RyaW5nRmllbGQgPSBHdWFyZHMuaXNTdHJpbmcoc3RhdGUuX2ZpZWxkKVxuICAgICAgICAgICAgICAgIGNvbnN0IGlzT2JqZWN0RmllbGQgPSBHdWFyZHMuaXNPYmplY3Qoc3RhdGUuX2ZpZWxkKVxuXG4gICAgICAgICAgICAgICAgc3RhdGUuX2NvbGxlY3Rpb24gPSBzdGF0ZS5fY29sbGVjdGlvbi5zb3J0KChsLCByKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBuID0gMFxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1N0cmluZ0ZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsID0gbFtzdGF0ZS5fZmllbGRdXG4gICAgICAgICAgICAgICAgICAgICAgICByID0gcltzdGF0ZS5fZmllbGRdXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNPYmplY3RGaWVsZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbCA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5fZmllbGQgYXMgVHlwZXMuQXJyYXkuU29ydC5GaWVsZE9iamVjdDxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWFBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICApLmhhbmRsZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJE9iamVjdChsKS5nZXRYUGF0aChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuX2ZpZWxkIGFzIFR5cGVzLkFycmF5LlNvcnQuRmllbGRPYmplY3Q8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYUGF0aFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLnhwYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgciA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5fZmllbGQgYXMgVHlwZXMuQXJyYXkuU29ydC5GaWVsZE9iamVjdDxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWFBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICApLmhhbmRsZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJE9iamVjdChyKS5nZXRYUGF0aChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuX2ZpZWxkIGFzIFR5cGVzLkFycmF5LlNvcnQuRmllbGRPYmplY3Q8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYUGF0aFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLnhwYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyaW5nc0NvbXBhcmF0aW9uID0gVHlwZXMuQXJyYXkuU29ydC5jb21wYXJlU3RyaW5ncyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQXNjLFxuICAgICAgICAgICAgICAgICAgICAgICAgR3VhcmRzLmlzU3RyaW5nKGwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgR3VhcmRzLmlzU3RyaW5nKHIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJcbiAgICAgICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChHdWFyZHMuaXNOdW1iZXIoc3RyaW5nc0NvbXBhcmF0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHN0cmluZ3NDb21wYXJhdGlvblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtYmVyc0NvbXBhcmF0aW9uID0gVHlwZXMuQXJyYXkuU29ydC5jb21wYXJlTnVtYmVycyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQXNjLFxuICAgICAgICAgICAgICAgICAgICAgICAgR3VhcmRzLmlzTnVtYmVyKGwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgR3VhcmRzLmlzTnVtYmVyKHIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJcbiAgICAgICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChHdWFyZHMuaXNOdW1iZXIobnVtYmVyc0NvbXBhcmF0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbiA9IG51bWJlcnNDb21wYXJhdGlvblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9vbGVhbkNvbXBhcmF0aW9uID0gVHlwZXMuQXJyYXkuU29ydC5jb21wYXJlQm9vbGVhbnMoXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0FzYyxcbiAgICAgICAgICAgICAgICAgICAgICAgIEd1YXJkcy5pc0Jvb2xlYW4obCksXG4gICAgICAgICAgICAgICAgICAgICAgICBHdWFyZHMuaXNCb29sZWFuKHIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJcbiAgICAgICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChHdWFyZHMuaXNOdW1iZXIoYm9vbGVhbkNvbXBhcmF0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGJvb2xlYW5Db21wYXJhdGlvblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgb25VcGRhdGVDYWxsYmFjaygpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpbnN0YWxsKClcblxuICAgICAgICBpZiAoIWNhbGxlZCkge1xuICAgICAgICAgICAgdXBkYXRlKHtcbiAgICAgICAgICAgICAgICBmaWVsZCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBjYWxsZWQgPSB0cnVlXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY2xlYW51cDogaW5zdGFsbCxcbiAgICAgICAgICAgIHVwZGF0ZSxcbiAgICAgICAgfVxuICAgIH1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlU29ydFxuIl19
