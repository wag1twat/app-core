{"version":3,"sources":["Base/Array/create-sort/create-sort.js","../src/Base/Array/create-sort/create-sort.ts"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","createSort","Types_1","require","Guards_1","get_xpath_1","get_compare_function_1","collection","options","let","called","field","order","orders","onMount","onSortUpdate","state","slice","Types","Array","Sort","defaultOrder","defaultOrders","undefined","onSortUpdateCallback","Guards","isFunc","getValue","item","isString","default","isObject","handler","xpath","setField","isUndefined","setOrder","noUpdateOrderFalsyEqualXPath","is","lastOrderIndex","length","nextOrderIndex","indexOf","update","sort","l","r","cleanup"],"mappings":"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","file":"create-sort.js","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createSort = void 0;\nconst Types_1 = require(\"../../Types\");\nconst Guards_1 = require(\"../../../Guards\");\nconst get_xpath_1 = __importDefault(require(\"../../Object/get-xpath\"));\nconst get_compare_function_1 = __importDefault(require(\"./get-compare-function\"));\nconst createSort = (collection) => {\n    return (options) => {\n        let called = false;\n        const { field, order, orders, onMount = true, onSortUpdate } = options;\n        const state = {\n            collection: collection.slice(),\n            order: order ? order : Types_1.Types.Array.Sort.defaultOrder,\n            orders: orders ? orders : Types_1.Types.Array.Sort.defaultOrders,\n            field: field ? field : undefined,\n        };\n        //callbacks\n        const onSortUpdateCallback = () => {\n            if (Guards_1.Guards.isFunc(onSortUpdate)) {\n                onSortUpdate(state);\n            }\n        };\n        // utilities\n        const getValue = (item) => {\n            if (Guards_1.Guards.isString(state.field)) {\n                return (0, get_xpath_1.default)(item)(state.field);\n            }\n            if (Guards_1.Guards.isObject(state.field)) {\n                return state.field.handler((0, get_xpath_1.default)(item)(state.field.xpath));\n            }\n            return item;\n        };\n        const cleanup = () => {\n            state.field = field ? field : undefined;\n            state.order = order ? order : Types_1.Types.Array.Sort.defaultOrder;\n            state.orders = orders ? orders : Types_1.Types.Array.Sort.defaultOrders;\n            state.collection = collection.slice();\n            onSortUpdateCallback();\n        };\n        const setField = (field) => {\n            if (!Guards_1.Guards.isUndefined(field)) {\n                state.field = field;\n            }\n        };\n        const setOrder = (field, noUpdateOrderFalsyEqualXPath) => {\n            let is = false;\n            if (noUpdateOrderFalsyEqualXPath) {\n                if (Guards_1.Guards.isString(state.field) && Guards_1.Guards.isString(field)) {\n                    if (state.field === field) {\n                        is = true && called;\n                    }\n                }\n                else if (Guards_1.Guards.isString(state.field) && Guards_1.Guards.isObject(field)) {\n                    if (state.field === field.xpath) {\n                        is = true && called;\n                    }\n                }\n                else if (Guards_1.Guards.isObject(state.field) && Guards_1.Guards.isString(field)) {\n                    if (state.field.xpath === field) {\n                        is = true && called;\n                    }\n                }\n                else if (Guards_1.Guards.isObject(state.field) && Guards_1.Guards.isObject(field)) {\n                    if (state.field.xpath === field.xpath) {\n                        is = true && called;\n                    }\n                }\n            }\n            else {\n                is = true && called;\n            }\n            if (is) {\n                const lastOrderIndex = state.orders.length - 1;\n                const currentOrderIndex = state.orders.indexOf(state.order);\n                const nextOrderIndex = currentOrderIndex + 1;\n                state.order =\n                    nextOrderIndex <= lastOrderIndex\n                        ? state.orders[nextOrderIndex]\n                        : state.orders[0];\n            }\n        };\n        const update = (options = {}) => {\n            const { field, noUpdateOrderFalsyEqualXPath = false } = options;\n            setOrder(field, noUpdateOrderFalsyEqualXPath);\n            setField(field);\n            if (state.order === 'default') {\n                state.collection = collection.slice();\n                onSortUpdateCallback();\n            }\n            else {\n                state.collection = state.collection.slice().sort((l, r) => (0, get_compare_function_1.default)(state.order, getValue(l), getValue(r)));\n                onSortUpdateCallback();\n            }\n        };\n        if (!called && onMount) {\n            update({\n                field,\n            });\n            called = true;\n        }\n        return {\n            cleanup,\n            update,\n        };\n    };\n};\nexports.createSort = createSort;\n","import { Types } from '../../Types'\nimport { Guards } from '../../../Guards'\nimport getXPath from '../../Object/get-xpath'\nimport getCompareFunction from './get-compare-function'\n\nconst createSort = <T extends any[]>(collection: T) => {\n    return <XPath extends Types.Utility.JSONPath<Types.Array.Of<T>>>(\n        options: Types.Array.Sort.Options<T, XPath>\n    ) => {\n        let called: boolean = false\n\n        const { field, order, orders, onMount = true, onSortUpdate } = options\n\n        const state: Types.Array.Sort.State<T> = {\n            collection: collection.slice() as T,\n            order: order ? order : Types.Array.Sort.defaultOrder,\n            orders: orders ? orders : Types.Array.Sort.defaultOrders,\n            field: field ? field : undefined,\n        }\n\n        //callbacks\n        const onSortUpdateCallback = () => {\n            if (Guards.isFunc(onSortUpdate)) {\n                onSortUpdate(state)\n            }\n        }\n        // utilities\n        const getValue = (item: Types.Array.Of<T>) => {\n            if (Guards.isString(state.field)) {\n                return getXPath(item)(state.field)\n            }\n            if (Guards.isObject(state.field)) {\n                return state.field.handler(getXPath(item)(state.field.xpath))\n            }\n            return item\n        }\n\n        const cleanup = () => {\n            state.field = field ? field : undefined\n            state.order = order ? order : Types.Array.Sort.defaultOrder\n            state.orders = orders ? orders : Types.Array.Sort.defaultOrders\n            state.collection = collection.slice() as T\n            onSortUpdateCallback()\n        }\n\n        const setField = <XPath extends Types.Utility.JSONPath<Types.Array.Of<T>>>(\n            field: Types.Array.Sort.Field<T, XPath> | undefined\n        ) => {\n            if (!Guards.isUndefined(field)) {\n                state.field = field\n            }\n        }\n\n        const setOrder = <XPath extends Types.Utility.JSONPath<Types.Array.Of<T>>>(\n            field: Types.Array.Sort.Field<T, XPath> | undefined,\n            noUpdateOrderFalsyEqualXPath: boolean\n        ) => {\n            let is: boolean = false\n\n            if (noUpdateOrderFalsyEqualXPath) {\n                if (Guards.isString(state.field) && Guards.isString(field)) {\n                    if (state.field === field) {\n                        is = true && called\n                    }\n                } else if (Guards.isString(state.field) && Guards.isObject(field)) {\n                    if (state.field === field.xpath) {\n                        is = true && called\n                    }\n                } else if (Guards.isObject(state.field) && Guards.isString(field)) {\n                    if (state.field.xpath === field) {\n                        is = true && called\n                    }\n                } else if (Guards.isObject(state.field) && Guards.isObject(field)) {\n                    if (state.field.xpath === field.xpath) {\n                        is = true && called\n                    }\n                }\n            } else {\n                is = true && called\n            }\n\n            if (is) {\n                const lastOrderIndex = state.orders.length - 1\n                const currentOrderIndex = state.orders.indexOf(state.order)\n                const nextOrderIndex = currentOrderIndex + 1\n                state.order =\n                    nextOrderIndex <= lastOrderIndex\n                        ? state.orders[nextOrderIndex]\n                        : state.orders[0]\n            }\n        }\n\n        const update = <XPath extends Types.Utility.JSONPath<Types.Array.Of<T>>>(\n            options: Types.Array.Sort.UpdateOptions<T, XPath> = {}\n        ) => {\n            const { field, noUpdateOrderFalsyEqualXPath = false } = options\n\n            setOrder(field, noUpdateOrderFalsyEqualXPath)\n\n            setField(field)\n\n            if (state.order === 'default') {\n                state.collection = collection.slice() as T\n                onSortUpdateCallback()\n            } else {\n                state.collection = (state.collection.slice() as T).sort((l, r) =>\n                    getCompareFunction(\n                        state.order as Exclude<Types.Array.Sort.Order, 'default'>,\n                        getValue(l),\n                        getValue(r)\n                    )\n                )\n                onSortUpdateCallback()\n            }\n        }\n\n        if (!called && onMount) {\n            update({\n                field,\n            })\n            called = true\n        }\n\n        return {\n            cleanup,\n            update,\n        }\n    }\n}\n\nexport { createSort }\n"]}